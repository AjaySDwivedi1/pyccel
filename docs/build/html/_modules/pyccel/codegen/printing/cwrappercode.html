

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pyccel.codegen.printing.cwrappercode &mdash; pyccel * documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/fonts.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> pyccel
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules.html">docBranck</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">pyccel</a>
        
      </nav>


      <div class="wy-nav-content">
<div class="git-ribbon">
  <a href="http://github.com/SwissDataScienceCenter" rel="me">Join us on GitHub</a>
</div>

        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>pyccel.codegen.printing.cwrappercode</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyccel.codegen.printing.cwrappercode</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding: utf-8</span>
<span class="c1">#------------------------------------------------------------------------------------------#</span>
<span class="c1"># This file is part of Pyccel which is released under MIT License. See the LICENSE file or #</span>
<span class="c1"># go to https://github.com/pyccel/pyccel/blob/master/LICENSE for full license details.     #</span>
<span class="c1">#------------------------------------------------------------------------------------------#</span>
<span class="c1"># pylint: disable=no-self-use</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="kn">from</span> <span class="nn">pyccel.codegen.printing.ccode</span> <span class="kn">import</span> <span class="n">CCodePrinter</span>

<span class="kn">from</span> <span class="nn">pyccel.ast.bind_c</span>   <span class="kn">import</span> <span class="n">as_static_function</span><span class="p">,</span> <span class="n">wrap_module_array_var</span><span class="p">,</span> <span class="n">BindCPointer</span>

<span class="kn">from</span> <span class="nn">pyccel.ast.builtins</span> <span class="kn">import</span> <span class="n">PythonTuple</span>

<span class="kn">from</span> <span class="nn">pyccel.ast.core</span> <span class="kn">import</span> <span class="n">Assign</span><span class="p">,</span> <span class="n">AliasAssign</span><span class="p">,</span> <span class="n">FunctionDef</span><span class="p">,</span> <span class="n">FunctionAddress</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.core</span> <span class="kn">import</span> <span class="n">If</span><span class="p">,</span> <span class="n">IfSection</span><span class="p">,</span> <span class="n">Return</span><span class="p">,</span> <span class="n">FunctionCall</span><span class="p">,</span> <span class="n">Deallocate</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.core</span> <span class="kn">import</span> <span class="n">SeparatorComment</span><span class="p">,</span> <span class="n">Allocate</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.core</span> <span class="kn">import</span> <span class="n">Import</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">Declare</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.core</span> <span class="kn">import</span> <span class="n">AugAssign</span><span class="p">,</span> <span class="n">CodeBlock</span>

<span class="kn">from</span> <span class="nn">pyccel.ast.cwrapper</span>    <span class="kn">import</span> <span class="n">PyArg_ParseTupleNode</span><span class="p">,</span> <span class="n">PyBuildValueNode</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.cwrapper</span>    <span class="kn">import</span> <span class="n">PyArgKeywords</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.cwrapper</span>    <span class="kn">import</span> <span class="n">Py_None</span><span class="p">,</span> <span class="n">Py_DECREF</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.cwrapper</span>    <span class="kn">import</span> <span class="n">generate_datatype_error</span><span class="p">,</span> <span class="n">PyErr_SetString</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.cwrapper</span>    <span class="kn">import</span> <span class="n">scalar_object_check</span><span class="p">,</span> <span class="n">flags_registry</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.cwrapper</span>    <span class="kn">import</span> <span class="n">PyccelPyArrayObject</span><span class="p">,</span> <span class="n">PyccelPyObject</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.cwrapper</span>    <span class="kn">import</span> <span class="n">C_to_Python</span><span class="p">,</span> <span class="n">Python_to_C</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.cwrapper</span>    <span class="kn">import</span> <span class="n">PyModule_AddObject</span>

<span class="kn">from</span> <span class="nn">pyccel.ast.datatypes</span> <span class="kn">import</span> <span class="n">NativeInteger</span><span class="p">,</span> <span class="n">NativeBool</span><span class="p">,</span> <span class="n">NativeFloat</span><span class="p">,</span> <span class="n">str_dtype</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.datatypes</span> <span class="kn">import</span> <span class="n">datatype</span><span class="p">,</span> <span class="n">NativeVoid</span>

<span class="kn">from</span> <span class="nn">pyccel.ast.literals</span>  <span class="kn">import</span> <span class="n">LiteralTrue</span><span class="p">,</span> <span class="n">LiteralInteger</span><span class="p">,</span> <span class="n">LiteralString</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.literals</span>  <span class="kn">import</span> <span class="n">Nil</span>

<span class="kn">from</span> <span class="nn">pyccel.ast.numpy_wrapper</span>   <span class="kn">import</span> <span class="n">array_checker</span><span class="p">,</span> <span class="n">array_type_check</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.numpy_wrapper</span>   <span class="kn">import</span> <span class="n">pyarray_to_ndarray</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.numpy_wrapper</span>   <span class="kn">import</span> <span class="n">array_get_data</span><span class="p">,</span> <span class="n">array_get_dim</span>

<span class="kn">from</span> <span class="nn">pyccel.ast.operators</span> <span class="kn">import</span> <span class="n">PyccelEq</span><span class="p">,</span> <span class="n">PyccelNot</span><span class="p">,</span> <span class="n">PyccelOr</span><span class="p">,</span> <span class="n">PyccelAssociativeParenthesis</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.operators</span> <span class="kn">import</span> <span class="n">PyccelIsNot</span><span class="p">,</span> <span class="n">PyccelLt</span><span class="p">,</span> <span class="n">PyccelUnarySub</span>

<span class="kn">from</span> <span class="nn">pyccel.ast.variable</span>  <span class="kn">import</span> <span class="n">Variable</span><span class="p">,</span> <span class="n">DottedVariable</span>

<span class="kn">from</span> <span class="nn">pyccel.ast.c_concepts</span> <span class="kn">import</span> <span class="n">ObjectAddress</span>

<span class="kn">from</span> <span class="nn">pyccel.parser.scope</span>  <span class="kn">import</span> <span class="n">Scope</span>

<span class="kn">from</span> <span class="nn">pyccel.errors.errors</span>   <span class="kn">import</span> <span class="n">Errors</span>

<span class="n">errors</span> <span class="o">=</span> <span class="n">Errors</span><span class="p">()</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CWrapperCodePrinter&quot;</span><span class="p">,</span> <span class="s2">&quot;cwrappercode&quot;</span><span class="p">]</span>

<span class="n">dtype_registry</span> <span class="o">=</span> <span class="p">{(</span><span class="s1">&#39;pyobject&#39;</span>     <span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="s1">&#39;PyObject&#39;</span><span class="p">,</span>
                  <span class="p">(</span><span class="s1">&#39;pyarrayobject&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="s1">&#39;PyArrayObject&#39;</span><span class="p">,</span>
                  <span class="p">(</span><span class="s1">&#39;void&#39;</span>         <span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="s1">&#39;void&#39;</span><span class="p">,</span>
                  <span class="p">(</span><span class="s1">&#39;bind_c_ptr&#39;</span>   <span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="s1">&#39;void*&#39;</span><span class="p">}</span>

<span class="n">module_imports</span>  <span class="o">=</span> <span class="p">[</span><span class="n">Import</span><span class="p">(</span><span class="s1">&#39;numpy_version&#39;</span><span class="p">,</span> <span class="n">Module</span><span class="p">(</span><span class="s1">&#39;numpy_version&#39;</span><span class="p">,(),())),</span>
            <span class="n">Import</span><span class="p">(</span><span class="s1">&#39;numpy/arrayobject&#39;</span><span class="p">,</span> <span class="n">Module</span><span class="p">(</span><span class="s1">&#39;numpy/arrayobject&#39;</span><span class="p">,(),())),</span>
            <span class="n">Import</span><span class="p">(</span><span class="s1">&#39;cwrapper&#39;</span><span class="p">,</span> <span class="n">Module</span><span class="p">(</span><span class="s1">&#39;cwrapper&#39;</span><span class="p">,(),()))]</span>

<span class="n">cwrapper_ndarray_import</span> <span class="o">=</span> <span class="n">Import</span><span class="p">(</span><span class="s1">&#39;cwrapper_ndarrays&#39;</span><span class="p">,</span> <span class="n">Module</span><span class="p">(</span><span class="s1">&#39;cwrapper_ndarrays&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">()))</span>

<div class="viewcode-block" id="CWrapperCodePrinter"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter">[docs]</a><span class="k">class</span> <span class="nc">CWrapperCodePrinter</span><span class="p">(</span><span class="n">CCodePrinter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A printer to convert a python module to strings of c code creating</span>
<span class="sd">    an interface between python and an implementation of the module in c&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">target_language</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
        <span class="n">CCodePrinter</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_target_language</span> <span class="o">=</span> <span class="n">target_language</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cast_functions_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_to_free_PyObject_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function_wrapper_names</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_module_name</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="c1"># --------------------------------------------------------------------</span>
    <span class="c1">#                       Helper functions</span>
    <span class="c1"># --------------------------------------------------------------------</span>

<div class="viewcode-block" id="CWrapperCodePrinter.stored_in_c_pointer"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.stored_in_c_pointer">[docs]</a>    <span class="k">def</span> <span class="nf">stored_in_c_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Indicates whether the object a needs to be stored in a pointer</span>
<span class="sd">        in c code</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        a : PyccelAstNode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="p">(</span><span class="n">PyccelPyArrayObject</span><span class="p">,</span> <span class="n">PyccelPyObject</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">PyBuildValueNode</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CCodePrinter</span><span class="o">.</span><span class="n">stored_in_c_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">)</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.function_signature"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.function_signature">[docs]</a>    <span class="k">def</span> <span class="nf">function_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">print_arg_names</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="n">FunctionAddress</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]):</span>
            <span class="c1"># Functions with function addresses as arguments cannot be</span>
            <span class="c1"># exposed to python so there is no need to print their signature</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CCodePrinter</span><span class="o">.</span><span class="n">function_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">print_arg_names</span><span class="p">)</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.get_declare_type"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.get_declare_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_declare_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the declaration type of a variable</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        variable : Variable</span>
<span class="sd">            Variable holding information needed to choose the declaration type</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        type_declaration : String</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="n">BindCPointer</span><span class="p">():</span>
            <span class="k">return</span> <span class="s1">&#39;void *&#39;</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">prec</span>  <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">precision</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">!=</span> <span class="s2">&quot;pyarrayobject&quot;</span><span class="p">:</span>
            <span class="c1">#TODO: Remove when #757 is fixed</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_ndarray</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_optional</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;t_ndarray&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CCodePrinter</span><span class="o">.</span><span class="n">get_declare_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_in_dtype_registry</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stored_in_c_pointer</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> *&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.get_new_PyObject"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.get_new_PyObject">[docs]</a>    <span class="k">def</span> <span class="nf">get_new_PyObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create new PyccelPyObject Variable with the desired name</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        name       : String</span>
<span class="sd">            The desired name</span>

<span class="sd">        Returns: Variable</span>
<span class="sd">        -------</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Variable</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">PyccelPyObject</span><span class="p">(),</span>
                        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                        <span class="n">memory_handling</span><span class="o">=</span><span class="s1">&#39;alias&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.find_in_dtype_registry"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.find_in_dtype_registry">[docs]</a>    <span class="k">def</span> <span class="nf">find_in_dtype_registry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the corresponding C dtype in the dtype_registry</span>
<span class="sd">        raise PYCCEL_RESTRICTION_TODO if not found</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        dtype : String</span>
<span class="sd">            expression data type</span>

<span class="sd">        prec  : Integer</span>
<span class="sd">            expression precision</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dtype : String</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="k">return</span> <span class="n">dtype_registry</span><span class="p">[(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">prec</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CCodePrinter</span><span class="o">.</span><span class="n">find_in_dtype_registry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.get_default_assign"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.get_default_assign">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">func_arg</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="k">return</span> <span class="n">AliasAssign</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Nil</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">func_arg</span><span class="o">.</span><span class="n">is_optional</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AliasAssign</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Py_None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="p">(</span><span class="n">NativeFloat</span><span class="p">,</span> <span class="n">NativeInteger</span><span class="p">,</span> <span class="n">NativeBool</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">Assign</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">PyccelPyObject</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">AliasAssign</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Py_None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Default values are not implemented for this datatype : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func_arg</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.get_static_function"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.get_static_function">[docs]</a>    <span class="k">def</span> <span class="nf">get_static_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Create a static FunctionDef from the argument used for</span>
<span class="sd">        C/fortran binding.</span>
<span class="sd">        If target language is C return the argument function</span>
<span class="sd">        If target language is Fortran, return a static function which</span>
<span class="sd">        takes both the data and the shapes as arguments</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        function    : FunctionDef</span>
<span class="sd">            FunctionDef holding information needed to create static function</span>

<span class="sd">        Returns   :</span>
<span class="sd">        -----------</span>
<span class="sd">        static_func : FunctionDef</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_language</span> <span class="o">==</span> <span class="s1">&#39;fortran&#39;</span><span class="p">:</span>
            <span class="n">static_func</span> <span class="o">=</span> <span class="n">as_static_function</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">mod_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">static_func</span> <span class="o">=</span> <span class="n">function</span>

        <span class="k">return</span> <span class="n">static_func</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.static_function_signature"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.static_function_signature">[docs]</a>    <span class="k">def</span> <span class="nf">static_function_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract from the function definition all the information (name, input, output)</span>
<span class="sd">        needed to create the function signature used for C/fortran binding</span>

<span class="sd">        Parameters:</span>
<span class="sd">        ----------</span>
<span class="sd">        expr : FunctionDef</span>
<span class="sd">            The function defintion</span>

<span class="sd">        Return:</span>
<span class="sd">        ------</span>
<span class="sd">        String</span>
<span class="sd">            Signature of the function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#if target_language is C no need for the binding</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_language</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_signature</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">var</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">arguments</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ret_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_declare_type</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ret_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">datatype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
            <span class="n">args</span> <span class="o">+=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">memory_handling</span><span class="o">=</span><span class="s1">&#39;alias&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">results</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">datatype</span><span class="p">(</span><span class="s1">&#39;void&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">arg_code</span> <span class="o">=</span> <span class="s1">&#39;void&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arg_code</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_signature</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">FunctionAddress</span><span class="p">)</span>
                        <span class="k">else</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_static_declare_type</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">FunctionAddress</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">(*</span><span class="si">{}</span><span class="s1">)(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">arg_code</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{0}{1}</span><span class="s1">(</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_type</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">arg_code</span><span class="p">)</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.get_static_args"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.get_static_args">[docs]</a>    <span class="k">def</span> <span class="nf">get_static_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create bind_C arguments for arguments rank &gt; 0 in fortran.</span>
<span class="sd">        needed in static function call</span>
<span class="sd">        func(a) ==&gt; static_func(nd_dim(a) , nd_data(a))</span>
<span class="sd">        where nd_data(a) = buffer holding data</span>
<span class="sd">              nd_dim(a)  = size of array</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        argument    : Variable</span>
<span class="sd">            Variable holding information needed (rank)</span>

<span class="sd">        Returns     : List of arguments</span>
<span class="sd">            List that can contains Variables and FunctionCalls</span>
<span class="sd">        -----------</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_language</span> <span class="o">==</span> <span class="s1">&#39;fortran&#39;</span> <span class="ow">and</span> <span class="n">argument</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">arg_address</span> <span class="o">=</span> <span class="n">ObjectAddress</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
            <span class="n">static_args</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">FunctionCall</span><span class="p">(</span><span class="n">array_get_dim</span><span class="p">,</span> <span class="p">[</span><span class="n">arg_address</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">argument</span><span class="o">.</span><span class="n">rank</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">static_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ObjectAddress</span><span class="p">(</span><span class="n">FunctionCall</span><span class="p">(</span><span class="n">array_get_data</span><span class="p">,</span> <span class="p">[</span><span class="n">arg_address</span><span class="p">])))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">static_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">argument</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">static_args</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.get_static_declare_type"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.get_static_declare_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_static_declare_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the declaration type of a variable, this function is used for</span>
<span class="sd">        C/fortran binding using native C datatypes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variable : Variable</span>
<span class="sd">            Variable holding information needed to choose the declaration type</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">prec</span>  <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">precision</span>

        <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_in_dtype_registry</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stored_in_c_pointer</span><span class="p">(</span><span class="n">variable</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_language</span> <span class="o">==</span> <span class="s1">&#39;fortran&#39;</span> <span class="ow">and</span> <span class="n">variable</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.get_static_results"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.get_static_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_static_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create bind_C results for results rank &gt; 0 in fortran.</span>
<span class="sd">        needed in static function call</span>
<span class="sd">        func(a) ==&gt; static_func(a.shape[0] , &amp;a-&gt;raw_data)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        result      : Variable</span>
<span class="sd">            Variable holding information needed (rank)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        body : list</span>
<span class="sd">            Additional instructions (allocations and pointer assignments) for function body</span>

<span class="sd">        static_results : list</span>
<span class="sd">            Expanded list of function arguments corresponding to the given result</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">body</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_language</span> <span class="o">==</span> <span class="s1">&#39;fortran&#39;</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_temporary_variable</span><span class="p">(</span><span class="n">NativeInteger</span><span class="p">(),</span>
                         <span class="n">result</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_size&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">rank</span><span class="p">)</span>
                     <span class="p">]</span>
            <span class="n">nd_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_temporary_variable</span><span class="p">(</span><span class="n">dtype_or_var</span> <span class="o">=</span> <span class="n">NativeVoid</span><span class="p">(),</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">memory_handling</span> <span class="o">=</span> <span class="s1">&#39;alias&#39;</span><span class="p">)</span>
            <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Allocate</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">sizes</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">order</span><span class="p">,</span>
                <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unallocated&#39;</span><span class="p">))</span>
            <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AliasAssign</span><span class="p">(</span><span class="n">DottedVariable</span><span class="p">(</span><span class="n">NativeVoid</span><span class="p">(),</span> <span class="s1">&#39;raw_data&#39;</span><span class="p">,</span> <span class="n">memory_handling</span> <span class="o">=</span> <span class="s1">&#39;alias&#39;</span><span class="p">,</span>
                <span class="n">lhs</span><span class="o">=</span><span class="n">result</span><span class="p">),</span> <span class="n">nd_var</span><span class="p">))</span>

            <span class="n">static_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">ObjectAddress</span><span class="p">(</span><span class="n">nd_var</span><span class="p">),</span> <span class="o">*</span><span class="n">sizes</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">static_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">body</span><span class="p">,</span> <span class="n">static_results</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._get_static_func_call_code"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._get_static_func_call_code">[docs]</a>    <span class="k">def</span> <span class="nf">_get_static_func_call_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">static_func_args</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all code necessary to call the wrapped function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expr             : FunctionDef</span>
<span class="sd">                           The function being wrapped</span>
<span class="sd">        static_func_args : List of arguments</span>
<span class="sd">                           Arguments compatible with the static function</span>
<span class="sd">        results          : List of results</span>
<span class="sd">                           Results of the wrapped function</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        body             : List of Basic Nodes</span>
<span class="sd">                           List of nodes describing the instructions which call the</span>
<span class="sd">                           wrapped function</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">static_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_static_function</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FunctionCall</span><span class="p">(</span><span class="n">static_function</span><span class="p">,</span> <span class="n">static_func_args</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">static_func_results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">b</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_static_results</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                <span class="n">body</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="n">static_func_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

            <span class="n">results</span>   <span class="o">=</span> <span class="n">static_func_results</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">static_func_results</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="n">static_func_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">func_call</span> <span class="o">=</span> <span class="n">Assign</span><span class="p">(</span><span class="n">results</span><span class="p">,</span><span class="n">FunctionCall</span><span class="p">(</span><span class="n">static_function</span><span class="p">,</span> <span class="n">static_func_args</span><span class="p">))</span>
            <span class="n">body</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">func_call</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">body</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._get_check_type_statement"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._get_check_type_statement">[docs]</a>    <span class="k">def</span> <span class="nf">_get_check_type_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">collect_var</span><span class="p">,</span> <span class="n">compulsory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the code which checks if the variable collected from python</span>
<span class="sd">        has the expected type</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variable    : Variable</span>
<span class="sd">                      The variable containing the PythonObject</span>
<span class="sd">        collect_var : Variable</span>
<span class="sd">                      The variable in which the result will be saved,</span>
<span class="sd">                      used to provide information about the expected type</span>
<span class="sd">        compulsory  : bool</span>
<span class="sd">                      Indicates whether the argument is a compulsory argument</span>
<span class="sd">                      to the function (if not then it must have a default or</span>
<span class="sd">                      be optional)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        check : str</span>
<span class="sd">                A string containing the code which determines whether &#39;variable&#39;</span>
<span class="sd">                contains an object which can be saved in &#39;collect_var&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="n">array_type_check</span><span class="p">(</span><span class="n">collect_var</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>

        <span class="k">else</span> <span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="n">scalar_object_check</span><span class="p">(</span><span class="n">collect_var</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">compulsory</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">PyccelNot</span><span class="p">(</span><span class="n">ObjectAddress</span><span class="p">(</span><span class="n">collect_var</span><span class="p">))</span> \
                            <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> \
                      <span class="n">PyccelEq</span><span class="p">(</span><span class="n">ObjectAddress</span><span class="p">(</span><span class="n">collect_var</span><span class="p">),</span> <span class="n">ObjectAddress</span><span class="p">(</span><span class="n">Py_None</span><span class="p">))</span>
            <span class="n">check</span> <span class="o">=</span> <span class="n">PyccelAssociativeParenthesis</span><span class="p">(</span><span class="n">PyccelOr</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">check</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">check</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._get_wrapper_name"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._get_wrapper_name">[docs]</a>    <span class="k">def</span> <span class="nf">_get_wrapper_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        create wrapper function name</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        func      : FunctionDef or Interface</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        wrapper_name : string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span>         <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">name</span>
        <span class="n">wrapper_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_wrapper&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_function_wrapper_names</span><span class="p">[</span><span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrapper_name</span>

        <span class="k">return</span> <span class="n">wrapper_name</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.get_wrapper_arguments"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.get_wrapper_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">get_wrapper_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create wrapper arguments</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List of variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">python_func_args</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_PyObject</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">)</span>
        <span class="n">python_func_kwargs</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_PyObject</span><span class="p">(</span><span class="s2">&quot;kwargs&quot;</span><span class="p">)</span>
        <span class="n">python_func_selfarg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_PyObject</span><span class="p">(</span><span class="s2">&quot;self&quot;</span>  <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">python_func_args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">python_func_kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">python_func_selfarg</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">python_func_selfarg</span><span class="p">,</span> <span class="n">python_func_args</span><span class="p">,</span> <span class="n">python_func_kwargs</span><span class="p">]</span></div>


    <span class="c1"># -------------------------------------------------------------------</span>
    <span class="c1"># Functions managing the creation of wrapper body</span>
    <span class="c1"># -------------------------------------------------------------------</span>

<div class="viewcode-block" id="CWrapperCodePrinter._valued_variable_management"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._valued_variable_management">[docs]</a>    <span class="k">def</span> <span class="nf">_valued_variable_management</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">collect_var</span><span class="p">,</span> <span class="n">tmp_variable</span><span class="p">,</span> <span class="n">default_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Responsible for creating the body collecting the default value of a Variable</span>
<span class="sd">        and the check needed.</span>
<span class="sd">        If the Variable is optional create body to collect the new value</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variable      : Variable</span>
<span class="sd">                        The optional variable</span>
<span class="sd">        collect_var   : Variable</span>
<span class="sd">                        variable which holds the value collected with PyArg_Parsetuple</span>
<span class="sd">        tmp_variable  : Variable</span>
<span class="sd">                        The temporary variable  to hold result</span>
<span class="sd">        default_value : PyccelAstNode</span>
<span class="sd">                        Object containing the default value of the variable</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        section      :</span>
<span class="sd">            IfSection</span>
<span class="sd">        collect_body : List</span>
<span class="sd">            list containing the lines necessary to collect the new optional variable value</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">valued_var_check</span>  <span class="o">=</span> <span class="n">PyccelEq</span><span class="p">(</span><span class="n">ObjectAddress</span><span class="p">(</span><span class="n">collect_var</span><span class="p">),</span> <span class="n">ObjectAddress</span><span class="p">(</span><span class="n">Py_None</span><span class="p">))</span>
        <span class="n">collect_body</span>      <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">is_optional</span><span class="p">:</span>
            <span class="n">collect_body</span>  <span class="o">=</span> <span class="p">[</span><span class="n">AliasAssign</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">tmp_variable</span><span class="p">)]</span>
            <span class="n">section</span>       <span class="o">=</span> <span class="n">IfSection</span><span class="p">(</span><span class="n">valued_var_check</span><span class="p">,</span> <span class="p">[</span><span class="n">AliasAssign</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">Nil</span><span class="p">())])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">section</span>       <span class="o">=</span> <span class="n">IfSection</span><span class="p">(</span><span class="n">valued_var_check</span><span class="p">,</span> <span class="p">[</span><span class="n">Assign</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">section</span><span class="p">,</span> <span class="n">collect_body</span></div>


<div class="viewcode-block" id="CWrapperCodePrinter._body_scalar"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._body_scalar">[docs]</a>    <span class="k">def</span> <span class="nf">_body_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">collect_var</span><span class="p">,</span> <span class="n">default_value</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">error_check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">tmp_variable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Responsible for collecting value and managing error and create the body</span>
<span class="sd">        of arguments in format:</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variable      : Variable</span>
<span class="sd">                        the variable to be collected</span>
<span class="sd">        collect_var   : Variable</span>
<span class="sd">                        variable which holds the value collected with PyArg_Parsetuple</span>
<span class="sd">        default_value : PyccelAstNode</span>
<span class="sd">                        Object containing the default value of the variable</span>
<span class="sd">                        Default: None</span>
<span class="sd">        error_check   : boolean</span>
<span class="sd">                        True if checking the data type and raising error is needed</span>
<span class="sd">                        Default: False</span>
<span class="sd">        tmp_variable  : Variable</span>
<span class="sd">                        temporary variable to hold value</span>
<span class="sd">                        Default: None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        body : If block</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">var</span>      <span class="o">=</span> <span class="n">tmp_variable</span> <span class="k">if</span> <span class="n">tmp_variable</span> <span class="k">else</span> <span class="n">variable</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">collect_value</span> <span class="o">=</span> <span class="p">[</span><span class="n">Assign</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">FunctionCall</span><span class="p">(</span><span class="n">Python_to_C</span><span class="p">(</span><span class="n">var</span><span class="p">),</span> <span class="p">[</span><span class="n">collect_var</span><span class="p">]))]</span>

        <span class="k">if</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">section</span><span class="p">,</span> <span class="n">optional_collect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valued_variable_management</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">collect_var</span><span class="p">,</span> <span class="n">tmp_variable</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>
            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
            <span class="n">collect_value</span> <span class="o">+=</span> <span class="n">optional_collect</span>

        <span class="k">if</span> <span class="n">error_check</span><span class="p">:</span>
            <span class="n">check_type</span> <span class="o">=</span> <span class="n">scalar_object_check</span><span class="p">(</span><span class="n">collect_var</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IfSection</span><span class="p">(</span><span class="n">check_type</span><span class="p">,</span> <span class="n">collect_value</span><span class="p">))</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">generate_datatype_error</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IfSection</span><span class="p">(</span><span class="n">LiteralTrue</span><span class="p">(),</span> <span class="p">[</span><span class="n">error</span><span class="p">,</span> <span class="n">Return</span><span class="p">([</span><span class="n">Nil</span><span class="p">()])]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IfSection</span><span class="p">(</span><span class="n">LiteralTrue</span><span class="p">(),</span> <span class="n">collect_value</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">condition</span> <span class="o">==</span> <span class="n">LiteralTrue</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">body</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">If</span><span class="p">(</span><span class="o">*</span><span class="n">sections</span><span class="p">)</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._body_array"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._body_array">[docs]</a>    <span class="k">def</span> <span class="nf">_body_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">collect_var</span><span class="p">,</span> <span class="n">check_type</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Responsible for collecting value and managing error and create the body</span>
<span class="sd">        of arguments with rank greater than 0 in format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Variable : Variable</span>
<span class="sd">            The optional variable</span>
<span class="sd">        collect_var : variable</span>
<span class="sd">            the pyobject type variable  holder of value</span>
<span class="sd">        check_type : Boolean</span>
<span class="sd">            True if the type is needed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        body : list</span>
<span class="sd">            A list of statements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#check optional :</span>
        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">is_optional</span> <span class="p">:</span>
            <span class="n">check</span> <span class="o">=</span> <span class="n">PyccelNot</span><span class="p">(</span><span class="n">ObjectAddress</span><span class="p">(</span><span class="n">collect_var</span><span class="p">))</span>
            <span class="n">body</span> <span class="o">+=</span> <span class="p">[</span><span class="n">IfSection</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="p">[</span><span class="n">AliasAssign</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">Nil</span><span class="p">())])]</span>

        <span class="n">check</span> <span class="o">=</span> <span class="n">array_checker</span><span class="p">(</span><span class="n">collect_var</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">check_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_language</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">+=</span> <span class="p">[</span><span class="n">IfSection</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="p">[</span><span class="n">Return</span><span class="p">([</span><span class="n">Nil</span><span class="p">()])])]</span>

        <span class="n">collect_func</span> <span class="o">=</span> <span class="n">FunctionCall</span><span class="p">(</span><span class="n">pyarray_to_ndarray</span><span class="p">,</span> <span class="p">[</span><span class="n">collect_var</span><span class="p">])</span>
        <span class="n">body</span> <span class="o">+=</span> <span class="p">[</span><span class="n">IfSection</span><span class="p">(</span><span class="n">LiteralTrue</span><span class="p">(),</span> <span class="p">[</span><span class="n">Assign</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span>
                            <span class="n">collect_func</span><span class="p">)])]</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">If</span><span class="p">(</span><span class="o">*</span><span class="n">body</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">body</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._body_management"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._body_management">[docs]</a>    <span class="k">def</span> <span class="nf">_body_management</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">collect_var</span><span class="p">,</span> <span class="n">default_value</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">check_type</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Responsible for calling functions that take care of body creation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variable      : Variable</span>
<span class="sd">                        The Variable (which may be optional)</span>
<span class="sd">        collect_var   : Variable</span>
<span class="sd">                        the pyobject type variable  holder of value</span>
<span class="sd">        default_value : PyccelAstNode</span>
<span class="sd">                        Object containing the default value of the variable</span>
<span class="sd">                        Default: None</span>
<span class="sd">        check_type    : Boolean</span>
<span class="sd">                        True if the type is needed</span>
<span class="sd">                        Default: False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        body : list</span>
<span class="sd">            A list of statements</span>
<span class="sd">        tmp_variable : Variable</span>
<span class="sd">            temporary variable to hold value default None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tmp_variable</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">body</span>         <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_body_array</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">collect_var</span><span class="p">,</span> <span class="n">check_type</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">is_optional</span><span class="p">:</span>
                <span class="n">tmp_variable</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">variable</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">precision</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span>
                                        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_tmp&quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">tmp_variable</span><span class="p">)</span>

            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_body_scalar</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">collect_var</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">check_type</span><span class="p">,</span> <span class="n">tmp_variable</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">body</span><span class="p">,</span> <span class="n">tmp_variable</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.untranslatable_function"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.untranslatable_function">[docs]</a>    <span class="k">def</span> <span class="nf">untranslatable_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrapper_name</span><span class="p">,</span> <span class="n">wrapper_args</span><span class="p">,</span> <span class="n">wrapper_results</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Certain functions are not handled in the wrapper (e.g. private),</span>
<span class="sd">        This creates a wrapper function which raises NotImplementedError</span>
<span class="sd">        exception and returns NULL</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wrapper_name    : string</span>
<span class="sd">            The name of the C wrapper function</span>

<span class="sd">        wrapper_args    : list of Variables</span>
<span class="sd">            List of variables with dtype PyObject which hold the arguments</span>
<span class="sd">            passed to the function</span>

<span class="sd">        wrapper_results : Variable</span>
<span class="sd">            List containing one variable with dtype PyObject which represents</span>
<span class="sd">            the variable which will be returned by the function</span>

<span class="sd">        error_msg       : string</span>
<span class="sd">            The message to be raised in the NotImplementedError</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        code : string</span>
<span class="sd">            returns the string containing the printed FunctionDef</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span>
        <span class="n">wrapper_func</span> <span class="o">=</span> <span class="n">FunctionDef</span><span class="p">(</span>
                <span class="n">name</span>      <span class="o">=</span> <span class="n">wrapper_name</span><span class="p">,</span>
                <span class="n">arguments</span> <span class="o">=</span> <span class="n">wrapper_args</span><span class="p">,</span>
                <span class="n">results</span>   <span class="o">=</span> <span class="n">wrapper_results</span><span class="p">,</span>
                <span class="n">body</span>      <span class="o">=</span> <span class="p">[</span>
                                <span class="n">PyErr_SetString</span><span class="p">(</span><span class="s1">&#39;PyExc_NotImplementedError&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)),</span>
                                <span class="n">AliasAssign</span><span class="p">(</span><span class="n">wrapper_results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Nil</span><span class="p">()),</span>
                                <span class="n">Return</span><span class="p">(</span><span class="n">wrapper_results</span><span class="p">)</span>
                            <span class="p">],</span>
                <span class="n">scope</span>     <span class="o">=</span> <span class="n">Scope</span><span class="p">())</span>

        <span class="n">code</span> <span class="o">=</span> <span class="n">CCodePrinter</span><span class="o">.</span><span class="n">_print_FunctionDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrapper_func</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_scope</span><span class="p">(</span><span class="n">current_scope</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">code</span></div>

    <span class="c1"># -------------------------------------------------------------------</span>
    <span class="c1"># Parsing arguments and building values Types functions</span>
    <span class="c1"># -------------------------------------------------------------------</span>
<div class="viewcode-block" id="CWrapperCodePrinter.get_PyArgParseType"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.get_PyArgParseType">[docs]</a>    <span class="k">def</span> <span class="nf">get_PyArgParseType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Responsible for creating any necessary intermediate variables which are used</span>
<span class="sd">        to collect the result of PyArgParse, and collecting the required cast function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variable : Variable</span>
<span class="sd">            The variable which will be passed to the translated function</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        collect_var : Variable</span>
<span class="sd">            The variable which will be used to collect the argument</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">collect_type</span> <span class="o">=</span> <span class="n">PyccelPyArrayObject</span><span class="p">()</span>
            <span class="n">collect_var</span>  <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">collect_type</span><span class="p">,</span>
                                <span class="n">memory_handling</span><span class="o">=</span><span class="s1">&#39;alias&#39;</span><span class="p">,</span> <span class="n">rank</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">rank</span><span class="p">,</span>
                                <span class="n">order</span><span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">order</span><span class="p">,</span>
                                <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_tmp&quot;</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">collect_type</span> <span class="o">=</span> <span class="n">PyccelPyObject</span><span class="p">()</span>
            <span class="n">collect_var</span>  <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">collect_type</span><span class="p">,</span>
                                <span class="n">memory_handling</span><span class="o">=</span><span class="s1">&#39;alias&#39;</span><span class="p">,</span>
                                <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_tmp&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">collect_var</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">collect_var</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.get_PyBuildValue"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.get_PyBuildValue">[docs]</a>    <span class="k">def</span> <span class="nf">get_PyBuildValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Responsible for collecting the variable required to build the result</span>
<span class="sd">        and the necessary cast function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variable : Variable</span>
<span class="sd">            The variable returned by the translated function</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        collect_var : Variable</span>
<span class="sd">            The variable which will be provided to PyBuild</span>

<span class="sd">        cast_func_stmts : functionCall</span>
<span class="sd">            call to cast function responsible for the conversion of one data type into another</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">rank</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_import</span><span class="p">(</span><span class="n">cwrapper_ndarray_import</span><span class="p">)</span>


        <span class="n">cast_function</span> <span class="o">=</span> <span class="n">FunctionCall</span><span class="p">(</span><span class="n">C_to_Python</span><span class="p">(</span><span class="n">variable</span><span class="p">),</span> <span class="p">[</span><span class="n">ObjectAddress</span><span class="p">(</span><span class="n">variable</span><span class="p">)])</span>

        <span class="n">collect_type</span> <span class="o">=</span> <span class="n">PyccelPyObject</span><span class="p">()</span>
        <span class="n">collect_var</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">collect_type</span><span class="p">,</span> <span class="n">memory_handling</span><span class="o">=</span><span class="s1">&#39;alias&#39;</span><span class="p">,</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_tmp&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">collect_var</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_to_free_PyObject_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">collect_var</span><span class="p">)</span> <span class="c1">#TODO remove in next PR</span>

        <span class="k">return</span> <span class="n">collect_var</span><span class="p">,</span> <span class="n">cast_function</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.insert_constant"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.insert_constant">[docs]</a>    <span class="k">def</span> <span class="nf">insert_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mod_name</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">collect_var</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a variable into the module</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mod_name    : str</span>
<span class="sd">                      The name of the module variable</span>
<span class="sd">        var_name    : str</span>
<span class="sd">                      The name which will be used to identify the</span>
<span class="sd">                      variable in python. (This is usually var.name,</span>
<span class="sd">                      however it may differ due to the case-insensitivity</span>
<span class="sd">                      of fortran)</span>
<span class="sd">        var         : Variable</span>
<span class="sd">                      The module variable</span>
<span class="sd">        collect_var : Variable</span>
<span class="sd">                      A PyObject* variable to store temporaries</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list : A list of PyccelAstNodes to be appended to the body of the</span>
<span class="sd">                pymodule initialisation function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">rank</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_import</span><span class="p">(</span><span class="n">cwrapper_ndarray_import</span><span class="p">)</span>

        <span class="n">collect_value</span> <span class="o">=</span> <span class="n">AliasAssign</span><span class="p">(</span><span class="n">collect_var</span><span class="p">,</span>
                                <span class="n">FunctionCall</span><span class="p">(</span><span class="n">C_to_Python</span><span class="p">(</span><span class="n">var</span><span class="p">),</span> <span class="p">[</span><span class="n">ObjectAddress</span><span class="p">(</span><span class="n">var</span><span class="p">)]))</span>
        <span class="n">add_expr</span> <span class="o">=</span> <span class="n">PyModule_AddObject</span><span class="p">(</span><span class="n">mod_name</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">collect_var</span><span class="p">)</span>
        <span class="n">if_expr</span> <span class="o">=</span> <span class="n">If</span><span class="p">(</span><span class="n">IfSection</span><span class="p">(</span><span class="n">PyccelLt</span><span class="p">(</span><span class="n">add_expr</span><span class="p">,</span><span class="n">LiteralInteger</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
                        <span class="p">[</span><span class="n">FunctionCall</span><span class="p">(</span><span class="n">Py_DECREF</span><span class="p">,</span> <span class="p">[</span><span class="n">collect_var</span><span class="p">]),</span>
                         <span class="n">Return</span><span class="p">([</span><span class="n">PyccelUnarySub</span><span class="p">(</span><span class="n">LiteralInteger</span><span class="p">(</span><span class="mi">1</span><span class="p">))])]))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">collect_value</span><span class="p">,</span> <span class="n">if_expr</span><span class="p">]</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter.get_module_exec_function"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter.get_module_exec_function">[docs]</a>    <span class="k">def</span> <span class="nf">get_module_exec_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exec_func_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the function which executes any statements which happen</span>
<span class="sd">        when the module is loaded</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expr           : Module</span>
<span class="sd">                         The module being wrapped</span>
<span class="sd">        exec_func_name : str</span>
<span class="sd">                         The name of the function</span>

<span class="sd">        Result</span>
<span class="sd">        ------</span>
<span class="sd">        str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create scope for the module initialisation function</span>
        <span class="n">scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">new_child_scope</span><span class="p">(</span><span class="n">exec_func_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_scope</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>

        <span class="c1">#Create module variable</span>
        <span class="n">mod_var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="n">mod_var</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">PyccelPyObject</span><span class="p">(),</span>
                      <span class="n">name</span>       <span class="o">=</span> <span class="n">mod_var_name</span><span class="p">,</span>
                      <span class="n">memory_handling</span> <span class="o">=</span> <span class="s1">&#39;alias&#39;</span><span class="p">)</span>
        <span class="n">scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">mod_var</span><span class="p">)</span>

        <span class="c1"># Collect module variables from translated code</span>
        <span class="n">orig_vars_to_wrap</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">variables</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">is_private</span><span class="p">]</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_language</span> <span class="o">==</span> <span class="s1">&#39;fortran&#39;</span><span class="p">:</span>
            <span class="c1"># Collect python compatible module variables</span>
            <span class="n">vars_to_wrap</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">orig_vars_to_wrap</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Get pointer to store array data</span>
                    <span class="n">var</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_temporary_variable</span><span class="p">(</span><span class="n">dtype_or_var</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">memory_handling</span> <span class="o">=</span> <span class="s1">&#39;alias&#39;</span><span class="p">,</span>
                            <span class="n">rank</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="c1"># Create variables to store sizes of array</span>
                    <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">scope</span><span class="o">.</span><span class="n">get_temporary_variable</span><span class="p">(</span><span class="n">NativeInteger</span><span class="p">(),</span>
                            <span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_size&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">rank</span><span class="p">)]</span>
                    <span class="c1"># Get the bind_c function which wraps a fortran array and returns c objects</span>
                    <span class="n">var_wrapper</span> <span class="o">=</span> <span class="n">wrap_module_array_var</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">expr</span><span class="p">)</span>
                    <span class="c1"># Call bind_c function</span>
                    <span class="n">call</span> <span class="o">=</span> <span class="n">Assign</span><span class="p">(</span><span class="n">PythonTuple</span><span class="p">(</span><span class="n">ObjectAddress</span><span class="p">(</span><span class="n">var</span><span class="p">),</span> <span class="o">*</span><span class="n">sizes</span><span class="p">),</span> <span class="n">FunctionCall</span><span class="p">(</span><span class="n">var_wrapper</span><span class="p">,</span> <span class="p">()))</span>
                    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>

                    <span class="c1"># Create ndarray to store array data</span>
                    <span class="n">nd_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_temporary_variable</span><span class="p">(</span><span class="n">dtype_or_var</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">memory_handling</span> <span class="o">=</span> <span class="s1">&#39;alias&#39;</span>
                            <span class="p">)</span>
                    <span class="n">alloc</span> <span class="o">=</span> <span class="n">Allocate</span><span class="p">(</span><span class="n">nd_var</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">sizes</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">nd_var</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s1">&#39;unallocated&#39;</span><span class="p">)</span>
                    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alloc</span><span class="p">)</span>
                    <span class="c1"># Save raw_data into ndarray to obtain useable pointer</span>
                    <span class="n">set_data</span> <span class="o">=</span> <span class="n">AliasAssign</span><span class="p">(</span><span class="n">DottedVariable</span><span class="p">(</span><span class="n">NativeVoid</span><span class="p">(),</span> <span class="s1">&#39;raw_data&#39;</span><span class="p">,</span>
                            <span class="n">memory_handling</span> <span class="o">=</span> <span class="s1">&#39;alias&#39;</span><span class="p">,</span> <span class="n">lhs</span><span class="o">=</span><span class="n">nd_var</span><span class="p">),</span> <span class="n">var</span><span class="p">)</span>
                    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">set_data</span><span class="p">)</span>
                    <span class="c1"># Save the ndarray to vars_to_wrap to be handled as if it came from C</span>
                    <span class="n">vars_to_wrap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nd_var</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Ensure correct name</span>
                    <span class="n">w</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">get_expected_name</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
                    <span class="n">assign</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get_user_nodes</span><span class="p">(</span><span class="n">Assign</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="c1"># assign.fst should always exist, but is not always set when the</span>
                    <span class="c1"># Assign is created in the codegen stage</span>
                    <span class="k">if</span> <span class="n">assign</span><span class="o">.</span><span class="n">fst</span><span class="p">:</span>
                        <span class="n">w</span><span class="o">.</span><span class="n">set_fst</span><span class="p">(</span><span class="n">assign</span><span class="o">.</span><span class="n">fst</span><span class="p">)</span>
                    <span class="n">vars_to_wrap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vars_to_wrap</span> <span class="o">=</span> <span class="n">orig_vars_to_wrap</span>
        <span class="n">var_names</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_python_name</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">orig_vars_to_wrap</span><span class="p">]</span>

        <span class="c1"># If there are any variables in the module then add them to the module object</span>
        <span class="k">if</span> <span class="n">vars_to_wrap</span><span class="p">:</span>
            <span class="c1"># Create variable for temporary python objects</span>
            <span class="n">tmp_var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
            <span class="n">tmp_var</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">PyccelPyObject</span><span class="p">(),</span>
                          <span class="n">name</span>       <span class="o">=</span> <span class="n">tmp_var_name</span><span class="p">,</span>
                          <span class="n">memory_handling</span> <span class="o">=</span> <span class="s1">&#39;alias&#39;</span><span class="p">)</span>
            <span class="n">scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">tmp_var</span><span class="p">)</span>
            <span class="c1"># Add code to add variable to module</span>
            <span class="n">body</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">l</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span><span class="n">vars_to_wrap</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">insert_constant</span><span class="p">(</span><span class="n">mod_var_name</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">tmp_var</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">init_func</span><span class="p">:</span>
            <span class="c1"># Call init function code</span>
            <span class="n">static_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_static_function</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">init_func</span><span class="p">)</span>
            <span class="n">body</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">FunctionCall</span><span class="p">(</span><span class="n">static_function</span><span class="p">,[],[]))</span>

        <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Return</span><span class="p">([</span><span class="n">LiteralInteger</span><span class="p">(</span><span class="mi">0</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit_scope</span><span class="p">()</span>

        <span class="n">func</span> <span class="o">=</span> <span class="n">FunctionDef</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">exec_func_name</span><span class="p">,</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span><span class="n">mod_var</span><span class="p">,),</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">get_temporary_variable</span><span class="p">(</span><span class="n">NativeInteger</span><span class="p">(),</span>
                <span class="n">precision</span> <span class="o">=</span> <span class="mi">4</span><span class="p">),),</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">CodeBlock</span><span class="p">(</span><span class="n">body</span><span class="p">),</span>
            <span class="n">scope</span> <span class="o">=</span> <span class="n">scope</span><span class="p">)</span>
        <span class="n">func_code</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_print_FunctionDef</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">func_code</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;static &quot;</span><span class="o">+</span><span class="n">func_code</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">func_code</span><span class="p">)</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._print_BindCPointer"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._print_BindCPointer">[docs]</a>    <span class="k">def</span> <span class="nf">_print_BindCPointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;bind_c_ptr&#39;</span></div>

    <span class="c1">#--------------------------------------------------------------------</span>
    <span class="c1">#                 _print_ClassName functions</span>
    <span class="c1">#--------------------------------------------------------------------</span>

<div class="viewcode-block" id="CWrapperCodePrinter._print_DottedName"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._print_DottedName">[docs]</a>    <span class="k">def</span> <span class="nf">_print_DottedName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">)</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._print_Interface"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._print_Interface">[docs]</a>    <span class="k">def</span> <span class="nf">_print_Interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>

        <span class="c1"># Find a name for the wrapper function</span>
        <span class="n">wrapper_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wrapper_name</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

        <span class="n">mod_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span>
        <span class="n">scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">new_child_scope</span><span class="p">(</span><span class="n">wrapper_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_scope</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>

        <span class="c1"># Collecting all functions</span>
        <span class="n">funcs</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">functions</span>

        <span class="c1"># Save all used names</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">insert_symbol</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Collect arguments and results</span>
        <span class="n">wrapper_args</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wrapper_arguments</span><span class="p">()</span>
        <span class="n">wrapper_results</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_new_PyObject</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">wrapper_results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Collect argument names for PyArgParse</span>
        <span class="n">arg_names</span>         <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arguments</span><span class="p">]</span>
        <span class="n">keyword_list_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="s1">&#39;kwlist&#39;</span><span class="p">)</span>
        <span class="n">keyword_list</span>      <span class="o">=</span> <span class="n">PyArgKeywords</span><span class="p">(</span><span class="n">keyword_list_name</span><span class="p">,</span> <span class="n">arg_names</span><span class="p">)</span>
        <span class="n">wrapper_body</span>      <span class="o">=</span> <span class="p">[</span><span class="n">keyword_list</span><span class="p">]</span>

        <span class="n">wrapper_body_translations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">body_tmp</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># To store the mini function responsible for collecting value and calling interfaces functions and return the builded value</span>
        <span class="n">funcs_def</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># dict to collect all initialisation needed in the wrapper</span>
        <span class="n">check_var</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">NativeInteger</span><span class="p">(),</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="s2">&quot;check&quot;</span><span class="p">))</span>
        <span class="n">scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">check_var</span><span class="p">,</span> <span class="n">check_var</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">types_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span> <span class="c1">#dict to collect each variable possible type and the corresponding flags</span>
        <span class="c1"># collect parse arg</span>
        <span class="n">parse_args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_PyArgParseType</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">var</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arguments</span><span class="p">]</span>

        <span class="c1"># Managing the body of wrapper</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span> <span class="p">:</span>
            <span class="n">mini_wrapper_func_body</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">res_args</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">static_func_args</span>  <span class="o">=</span> <span class="p">[]</span>

            <span class="n">mini_wrapper_func_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;_mini_wrapper&#39;</span><span class="p">)</span>
            <span class="n">mini_scope</span> <span class="o">=</span> <span class="n">mod_scope</span><span class="o">.</span><span class="n">new_child_scope</span><span class="p">(</span><span class="n">mini_wrapper_func_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_scope</span><span class="p">(</span><span class="n">mini_scope</span><span class="p">)</span>

            <span class="c1"># update ndarray local variables properties</span>
            <span class="n">arg_vars</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">var</span><span class="p">:</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">arguments</span><span class="p">}</span>
            <span class="n">local_arg_vars</span> <span class="o">=</span> <span class="p">{(</span><span class="n">v</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">memory_handling</span><span class="o">=</span><span class="s1">&#39;alias&#39;</span><span class="p">)</span>
                              <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Variable</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">is_optional</span> \
                              <span class="k">else</span> <span class="n">v</span><span class="p">)</span> <span class="p">:</span> <span class="n">a</span> <span class="k">for</span> <span class="n">v</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">arg_vars</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">local_arg_vars</span><span class="p">:</span>
                <span class="n">mini_scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
                <span class="n">mini_scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Loop for all args in every functions and create the corresponding condition and body</span>
            <span class="k">for</span> <span class="n">p_arg</span><span class="p">,</span> <span class="p">(</span><span class="n">f_var</span><span class="p">,</span> <span class="n">f_arg</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">parse_args</span><span class="p">,</span> <span class="n">local_arg_vars</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">collect_var</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_PyArgParseType</span><span class="p">(</span><span class="n">f_var</span><span class="p">)</span>
                <span class="n">body</span><span class="p">,</span> <span class="n">tmp_variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_body_management</span><span class="p">(</span><span class="n">f_var</span><span class="p">,</span> <span class="n">p_arg</span><span class="p">,</span> <span class="n">f_arg</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

                <span class="c1"># get check type function</span>
                <span class="n">check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_check_type_statement</span><span class="p">(</span><span class="n">f_var</span><span class="p">,</span> <span class="n">p_arg</span><span class="p">,</span> <span class="n">f_arg</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>

                <span class="c1"># Save the body</span>
                <span class="n">wrapper_body_translations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>

                <span class="c1"># Write default values</span>
                <span class="k">if</span> <span class="n">f_arg</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">wrapper_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default_assign</span><span class="p">(</span><span class="n">parse_args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">f_var</span><span class="p">,</span> <span class="n">f_arg</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

                <span class="c1"># Get Bind/C arguments</span>
                <span class="n">static_func_args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_static_args</span><span class="p">(</span><span class="n">f_var</span><span class="p">))</span>

                <span class="n">flag_value</span> <span class="o">=</span> <span class="n">flags_registry</span><span class="p">[(</span><span class="n">f_var</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">f_var</span><span class="o">.</span><span class="n">precision</span><span class="p">)]</span>
                <span class="n">flags</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">flag_value</span>  <span class="c1"># shift by 4 to the left</span>
                <span class="n">types_dict</span><span class="p">[</span><span class="n">f_var</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">f_var</span><span class="p">,</span> <span class="n">check</span><span class="p">,</span> <span class="n">flag_value</span><span class="p">))</span> <span class="c1"># collect variable type for each arguments</span>
                <span class="n">mini_wrapper_func_body</span> <span class="o">+=</span> <span class="n">body</span>

            <span class="c1"># create the corresponding function call</span>
            <span class="n">mini_wrapper_func_body</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_static_func_call_code</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">static_func_args</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">results</span><span class="p">))</span>


            <span class="c1"># Loop for all res in every functions and create the corresponding body and cast</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="n">results</span> <span class="p">:</span>
                <span class="n">collect_var</span><span class="p">,</span> <span class="n">cast_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_PyBuildValue</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cast_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">mini_wrapper_func_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AliasAssign</span><span class="p">(</span><span class="n">collect_var</span><span class="p">,</span> <span class="n">cast_func</span><span class="p">))</span>

                <span class="n">res_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ObjectAddress</span><span class="p">(</span><span class="n">collect_var</span><span class="p">)</span> <span class="k">if</span> <span class="n">collect_var</span><span class="o">.</span><span class="n">is_alias</span> <span class="k">else</span> <span class="n">collect_var</span><span class="p">)</span>

            <span class="c1"># Building PybuildValue and freeing the allocated variable after.</span>
            <span class="n">mini_wrapper_func_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AliasAssign</span><span class="p">(</span><span class="n">wrapper_results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">PyBuildValueNode</span><span class="p">(</span><span class="n">res_args</span><span class="p">)))</span>
            <span class="n">mini_wrapper_func_body</span> <span class="o">+=</span> <span class="p">[</span><span class="n">FunctionCall</span><span class="p">(</span><span class="n">Py_DECREF</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_free_PyObject_list</span><span class="p">]</span>

            <span class="c1"># Call free function for C type</span>
            <span class="n">mini_wrapper_func_body</span> <span class="o">+=</span> <span class="p">[</span><span class="n">If</span><span class="p">(</span><span class="n">IfSection</span><span class="p">(</span><span class="n">PyccelIsNot</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Nil</span><span class="p">()),</span> <span class="p">[</span><span class="n">Deallocate</span><span class="p">(</span><span class="n">i</span><span class="p">)]))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stored_in_c_pointer</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> \
                                        <span class="k">else</span> <span class="n">Deallocate</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">local_arg_vars</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">mini_wrapper_func_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="n">wrapper_results</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_to_free_PyObject_list</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_scope</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>

            <span class="c1"># Building Mini wrapper function</span>
            <span class="n">mini_wrapper_func_def</span> <span class="o">=</span> <span class="n">FunctionDef</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">mini_wrapper_func_name</span><span class="p">,</span>
                <span class="n">arguments</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">,</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">wrapper_results</span><span class="p">,</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">mini_wrapper_func_body</span><span class="p">,</span>
                <span class="n">scope</span> <span class="o">=</span> <span class="n">mini_scope</span><span class="p">)</span>
            <span class="n">funcs_def</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mini_wrapper_func_def</span><span class="p">)</span>

            <span class="c1"># append check condition to the functioncall</span>
            <span class="n">body_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IfSection</span><span class="p">(</span><span class="n">PyccelEq</span><span class="p">(</span><span class="n">check_var</span><span class="p">,</span> <span class="n">LiteralInteger</span><span class="p">(</span><span class="n">flags</span><span class="p">)),</span> <span class="p">[</span><span class="n">AliasAssign</span><span class="p">(</span><span class="n">wrapper_results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">FunctionCall</span><span class="p">(</span><span class="n">mini_wrapper_func_def</span><span class="p">,</span> <span class="n">parse_args</span><span class="p">))]))</span>

        <span class="c1"># Errors / Types management</span>
        <span class="c1"># Creating check_type function</span>
        <span class="n">check_func_def</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_wrapper_check</span><span class="p">(</span><span class="n">check_var</span><span class="p">,</span> <span class="n">parse_args</span><span class="p">,</span> <span class="n">types_dict</span><span class="p">,</span> <span class="n">funcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">funcs_def</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">check_func_def</span><span class="p">)</span>

        <span class="c1"># Create the wrapper body with collected informations</span>
        <span class="n">body_tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">IfSection</span><span class="p">(</span><span class="n">PyccelNot</span><span class="p">(</span><span class="n">check_var</span><span class="p">),</span> <span class="p">[</span><span class="n">Return</span><span class="p">([</span><span class="n">Nil</span><span class="p">()])])]</span> <span class="o">+</span> <span class="n">body_tmp</span>
        <span class="n">body_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IfSection</span><span class="p">(</span><span class="n">LiteralTrue</span><span class="p">(),</span>
            <span class="p">[</span><span class="n">PyErr_SetString</span><span class="p">(</span><span class="s1">&#39;PyExc_TypeError&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;This combination of arguments is not valid&quot;&#39;</span><span class="p">),</span>
            <span class="n">Return</span><span class="p">([</span><span class="n">Nil</span><span class="p">()])]))</span>
        <span class="n">wrapper_body_translations</span> <span class="o">=</span> <span class="p">[</span><span class="n">If</span><span class="p">(</span><span class="o">*</span><span class="n">body_tmp</span><span class="p">)]</span>

        <span class="c1"># Parsing Arguments</span>
        <span class="n">parse_node</span> <span class="o">=</span> <span class="n">PyArg_ParseTupleNode</span><span class="p">(</span><span class="o">*</span><span class="n">wrapper_args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                                          <span class="n">funcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arguments</span><span class="p">,</span>
                                          <span class="n">parse_args</span><span class="p">,</span> <span class="n">keyword_list</span><span class="p">)</span>

        <span class="n">wrapper_body</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">default_value</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">wrapper_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">If</span><span class="p">(</span><span class="n">IfSection</span><span class="p">(</span><span class="n">PyccelNot</span><span class="p">(</span><span class="n">parse_node</span><span class="p">),</span> <span class="p">[</span><span class="n">Return</span><span class="p">([</span><span class="n">Nil</span><span class="p">()])])))</span>

        <span class="c1">#finishing the wrapper body</span>
        <span class="n">wrapper_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Assign</span><span class="p">(</span><span class="n">check_var</span><span class="p">,</span> <span class="n">FunctionCall</span><span class="p">(</span><span class="n">check_func_def</span><span class="p">,</span> <span class="n">parse_args</span><span class="p">)))</span>
        <span class="n">wrapper_body</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">wrapper_body_translations</span><span class="p">)</span>
        <span class="n">wrapper_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="n">wrapper_results</span><span class="p">))</span> <span class="c1"># Return</span>

        <span class="c1"># Create FunctionDef</span>
        <span class="n">funcs_def</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FunctionDef</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">wrapper_name</span><span class="p">,</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="n">wrapper_args</span><span class="p">,</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">wrapper_results</span><span class="p">,</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">wrapper_body</span><span class="p">,</span>
            <span class="n">scope</span> <span class="o">=</span> <span class="n">scope</span><span class="p">))</span>

        <span class="n">sep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">SeparatorComment</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">exit_scope</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">sep</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CCodePrinter</span><span class="o">.</span><span class="n">_print_FunctionDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">funcs_def</span><span class="p">)</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._create_wrapper_check"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._create_wrapper_check">[docs]</a>    <span class="k">def</span> <span class="nf">_create_wrapper_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_var</span><span class="p">,</span> <span class="n">parse_args</span><span class="p">,</span> <span class="n">types_dict</span><span class="p">,</span> <span class="n">func_name</span><span class="p">):</span>
        <span class="n">check_func_body</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">types_dict</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">types_dict</span><span class="p">:</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">types</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">arg_type_check_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">types_dict</span><span class="p">[</span><span class="n">arg</span><span class="p">])</span>
            <span class="n">arg_type_check_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">arg_type_check_list</span><span class="p">:</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">flags</span>
                <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IfSection</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">AugAssign</span><span class="p">(</span><span class="n">check_var</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span> <span class="p">,</span><span class="n">value</span><span class="p">)]))</span>
                <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">flags</span> <span class="o">-=</span> <span class="mi">4</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39; or &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">precision</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; bit&#39;</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">precision</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;native&#39;</span><span class="p">,</span>
                                                    <span class="n">str_dtype</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">NativeBool</span><span class="p">)</span>
                            <span class="k">else</span>  <span class="n">str_dtype</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">types</span><span class="p">])</span>
            <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IfSection</span><span class="p">(</span><span class="n">LiteralTrue</span><span class="p">(),</span> <span class="p">[</span><span class="n">PyErr_SetString</span><span class="p">(</span><span class="s1">&#39;PyExc_TypeError&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1"> must be </span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">error</span><span class="p">)),</span> <span class="n">Return</span><span class="p">([</span><span class="n">LiteralInteger</span><span class="p">(</span><span class="mi">0</span><span class="p">)])]))</span>
            <span class="n">check_func_body</span> <span class="o">+=</span> <span class="p">[</span><span class="n">If</span><span class="p">(</span><span class="o">*</span><span class="n">body</span><span class="p">)]</span>

        <span class="n">check_func_body</span> <span class="o">=</span> <span class="p">[</span><span class="n">Assign</span><span class="p">(</span><span class="n">check_var</span><span class="p">,</span> <span class="n">LiteralInteger</span><span class="p">(</span><span class="mi">0</span><span class="p">))]</span> <span class="o">+</span> <span class="n">check_func_body</span>
        <span class="n">check_func_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Return</span><span class="p">([</span><span class="n">check_var</span><span class="p">]))</span>
        <span class="c1"># Creating check function definition</span>
        <span class="n">check_func_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">parent_scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="s1">&#39;type_check&#39;</span><span class="p">)</span>
        <span class="n">check_func_def</span> <span class="o">=</span> <span class="n">FunctionDef</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">check_func_name</span><span class="p">,</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">,</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">check_var</span><span class="p">],</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">check_func_body</span><span class="p">,</span>
            <span class="n">scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">new_child_scope</span><span class="p">(</span><span class="n">check_func_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">check_func_def</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._print_PyccelPyObject"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._print_PyccelPyObject">[docs]</a>    <span class="k">def</span> <span class="nf">_print_PyccelPyObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;pyobject&#39;</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._print_PyccelPyArrayObject"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._print_PyccelPyArrayObject">[docs]</a>    <span class="k">def</span> <span class="nf">_print_PyccelPyArrayObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_import</span><span class="p">(</span><span class="n">cwrapper_ndarray_import</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;pyarrayobject&#39;</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._print_PyArg_ParseTupleNode"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._print_PyArg_ParseTupleNode">[docs]</a>    <span class="k">def</span> <span class="nf">_print_PyArg_ParseTupleNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">name</span>    <span class="o">=</span> <span class="s1">&#39;PyArg_ParseTupleAndKeywords&#39;</span>
        <span class="n">pyarg</span>   <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">pyarg</span>
        <span class="n">pykwarg</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">pykwarg</span>
        <span class="n">flags</span>   <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">flags</span>
        <span class="c1"># All args are modified so even pointers are passed by address</span>
        <span class="n">args</span>    <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;&amp;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{name}</span><span class="s1">(</span><span class="si">{pyarg}</span><span class="s1">, </span><span class="si">{pykwarg}</span><span class="s1">, &quot;</span><span class="si">{flags}</span><span class="s1">&quot;, </span><span class="si">{kwlist}</span><span class="s1">, </span><span class="si">{args}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">pyarg</span><span class="o">=</span><span class="n">pyarg</span><span class="p">,</span>
                            <span class="n">pykwarg</span><span class="o">=</span><span class="n">pykwarg</span><span class="p">,</span>
                            <span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span><span class="p">,</span>
                            <span class="n">kwlist</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">arg_names</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span><span class="s1">&#39;</span><span class="si">{name}</span><span class="s1">(</span><span class="si">{pyarg}</span><span class="s1">, </span><span class="si">{pykwarg}</span><span class="s1">, &quot;&quot;, </span><span class="si">{kwlist}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">pyarg</span><span class="o">=</span><span class="n">pyarg</span><span class="p">,</span>
                    <span class="n">pykwarg</span><span class="o">=</span><span class="n">pykwarg</span><span class="p">,</span>
                    <span class="n">kwlist</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">arg_names</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">code</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._print_PyBuildValueNode"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._print_PyBuildValueNode">[docs]</a>    <span class="k">def</span> <span class="nf">_print_PyBuildValueNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">name</span>  <span class="o">=</span> <span class="s1">&#39;Py_BuildValue&#39;</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">flags</span>
        <span class="n">args</span>  <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>
        <span class="c1">#to change for args rank 1 +</span>
        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;(*</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">(&quot;</span><span class="si">{</span><span class="n">flags</span><span class="si">}</span><span class="s1">&quot;, </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s1">))&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;(*</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">(&quot;&quot;))&#39;</span>
        <span class="k">return</span> <span class="n">code</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._print_PyArgKeywords"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._print_PyArgKeywords">[docs]</a>    <span class="k">def</span> <span class="nf">_print_PyArgKeywords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">arg_names</span> <span class="o">=</span> <span class="s1">&#39;,</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">arg_names</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">Nil</span><span class="p">())])</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;static char *</span><span class="si">{name}</span><span class="s1">[] = {{</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;</span><span class="si">{arg_names}</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;}};</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">arg_names</span> <span class="o">=</span> <span class="n">arg_names</span><span class="p">))</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._print_PyModule_AddObject"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._print_PyModule_AddObject">[docs]</a>    <span class="k">def</span> <span class="nf">_print_PyModule_AddObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;PyModule_AddObject(</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">expr</span><span class="o">.</span><span class="n">mod_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">variable</span><span class="p">))</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._print_FunctionDef"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._print_FunctionDef">[docs]</a>    <span class="k">def</span> <span class="nf">_print_FunctionDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_scope</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">new_child_scope</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="n">local_arg_vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">arguments</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">var</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Variable</span><span class="p">):</span>
                <span class="n">new_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Variable</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span><span class="o">.</span><span class="n">is_optional</span><span class="p">):</span>
                    <span class="n">new_v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">memory_handling</span><span class="o">=</span><span class="s1">&#39;alias&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>
                <span class="n">local_arg_vars</span><span class="p">[</span><span class="n">new_v</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">new_v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="n">local_arg_vars</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>

        <span class="n">result_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">results</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result_vars</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="c1"># update ndarray and optional local variables properties</span>

        <span class="c1"># Find a name for the wrapper function</span>
        <span class="n">wrapper_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wrapper_name</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

        <span class="c1"># Collect arguments and results</span>
        <span class="n">wrapper_args</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wrapper_arguments</span><span class="p">()</span>
        <span class="n">wrapper_results</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_new_PyObject</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">wrapper_results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Collect argument names for PyArgParse</span>
        <span class="n">arg_names</span>         <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">local_arg_vars</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="n">keyword_list_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="s1">&#39;kwlist&#39;</span><span class="p">)</span>
        <span class="n">keyword_list</span>      <span class="o">=</span> <span class="n">PyArgKeywords</span><span class="p">(</span><span class="n">keyword_list_name</span><span class="p">,</span> <span class="n">arg_names</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_private</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit_scope</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">untranslatable_function</span><span class="p">(</span><span class="n">wrapper_name</span><span class="p">,</span>
                        <span class="n">wrapper_args</span><span class="p">,</span> <span class="n">wrapper_results</span><span class="p">,</span>
                        <span class="s2">&quot;Private functions are not accessible from python&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">FunctionAddress</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">local_arg_vars</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exit_scope</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">untranslatable_function</span><span class="p">(</span><span class="n">wrapper_name</span><span class="p">,</span>
                        <span class="n">wrapper_args</span><span class="p">,</span> <span class="n">wrapper_results</span><span class="p">,</span>
                        <span class="s2">&quot;Cannot pass a function as an argument&quot;</span><span class="p">)</span>

        <span class="n">wrapper_body</span>              <span class="o">=</span> <span class="p">[</span><span class="n">keyword_list</span><span class="p">]</span>
        <span class="n">wrapper_body_translations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">static_func_args</span>  <span class="o">=</span> <span class="p">[]</span>

        <span class="n">parse_args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">local_arg_vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">collect_var</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_PyArgParseType</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

            <span class="n">body</span><span class="p">,</span> <span class="n">tmp_variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_body_management</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">collect_var</span><span class="p">,</span> <span class="n">arg</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Save cast to argument variable</span>
            <span class="n">wrapper_body_translations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>

            <span class="n">parse_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">collect_var</span><span class="p">)</span>

            <span class="c1"># Get Bind/C arguments</span>
            <span class="n">static_func_args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_static_args</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>

            <span class="c1"># Write default values</span>
            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">wrapper_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default_assign</span><span class="p">(</span><span class="n">parse_args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">var</span><span class="p">,</span> <span class="n">arg</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

        <span class="c1"># Parse arguments</span>
        <span class="n">parse_node</span> <span class="o">=</span> <span class="n">PyArg_ParseTupleNode</span><span class="p">(</span><span class="o">*</span><span class="n">wrapper_args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                                          <span class="nb">list</span><span class="p">(</span><span class="n">local_arg_vars</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                                          <span class="n">parse_args</span><span class="p">,</span> <span class="n">keyword_list</span><span class="p">)</span>

        <span class="n">wrapper_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">If</span><span class="p">(</span><span class="n">IfSection</span><span class="p">(</span><span class="n">PyccelNot</span><span class="p">(</span><span class="n">parse_node</span><span class="p">),</span> <span class="p">[</span><span class="n">Return</span><span class="p">([</span><span class="n">Nil</span><span class="p">()])])))</span>
        <span class="n">wrapper_body</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">wrapper_body_translations</span><span class="p">)</span>

        <span class="n">wrapper_body</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_static_func_call_code</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">static_func_args</span><span class="p">,</span> <span class="n">result_vars</span><span class="p">))</span>

        <span class="c1"># Loop over results to carry out necessary casts and collect Py_BuildValue type string</span>
        <span class="n">res_args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">result_vars</span> <span class="p">:</span>
            <span class="n">collect_var</span><span class="p">,</span> <span class="n">cast_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_PyBuildValue</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cast_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">wrapper_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AliasAssign</span><span class="p">(</span><span class="n">collect_var</span><span class="p">,</span> <span class="n">cast_func</span><span class="p">))</span>

            <span class="n">res_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ObjectAddress</span><span class="p">(</span><span class="n">collect_var</span><span class="p">)</span> <span class="k">if</span> <span class="n">collect_var</span><span class="o">.</span><span class="n">is_alias</span> <span class="k">else</span> <span class="n">collect_var</span><span class="p">)</span>

        <span class="c1"># Call PyBuildNode</span>
        <span class="n">wrapper_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AliasAssign</span><span class="p">(</span><span class="n">wrapper_results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">PyBuildValueNode</span><span class="p">(</span><span class="n">res_args</span><span class="p">)))</span>

        <span class="c1"># Call free function for python type</span>
        <span class="n">wrapper_body</span> <span class="o">+=</span> <span class="p">[</span><span class="n">FunctionCall</span><span class="p">(</span><span class="n">Py_DECREF</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_free_PyObject_list</span><span class="p">]</span>

        <span class="c1"># Call free function for C type</span>
        <span class="n">wrapper_body</span> <span class="o">+=</span> <span class="p">[</span><span class="n">If</span><span class="p">(</span><span class="n">IfSection</span><span class="p">(</span><span class="n">PyccelIsNot</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Nil</span><span class="p">()),</span> <span class="p">[</span><span class="n">Deallocate</span><span class="p">(</span><span class="n">i</span><span class="p">)]))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stored_in_c_pointer</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> \
                            <span class="k">else</span> <span class="n">Deallocate</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">local_arg_vars</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_to_free_PyObject_list</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1">#Return</span>
        <span class="n">wrapper_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="n">wrapper_results</span><span class="p">))</span>

        <span class="c1"># Create FunctionDef and write using classic method</span>
        <span class="n">wrapper_func</span> <span class="o">=</span> <span class="n">FunctionDef</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">wrapper_name</span><span class="p">,</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="n">wrapper_args</span><span class="p">,</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">wrapper_results</span><span class="p">,</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">wrapper_body</span><span class="p">,</span>
            <span class="n">scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">exit_scope</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">CCodePrinter</span><span class="o">.</span><span class="n">_print_FunctionDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wrapper_func</span><span class="p">)</span></div>

<div class="viewcode-block" id="CWrapperCodePrinter._print_Module"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.CWrapperCodePrinter._print_Module">[docs]</a>    <span class="k">def</span> <span class="nf">_print_Module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_scope</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
        <span class="c1"># The initialisation and deallocation shouldn&#39;t be exposed to python</span>
        <span class="n">funcs_to_wrap</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">funcs</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">init_func</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">free_func</span><span class="p">)]</span>

        <span class="c1"># Insert declared objects into scope</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_language</span> <span class="o">==</span> <span class="s1">&#39;fortran&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">funcs</span><span class="p">:</span>
                <span class="n">scope</span><span class="o">.</span><span class="n">insert_symbol</span><span class="p">(</span><span class="s1">&#39;bind_c_&#39;</span><span class="o">+</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">is_private</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">scope</span><span class="o">.</span><span class="n">insert_symbol</span><span class="p">(</span><span class="s1">&#39;bind_c_&#39;</span><span class="o">+</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">scope</span><span class="o">.</span><span class="n">insert_symbol</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">funcs</span><span class="p">:</span>
                <span class="n">scope</span><span class="o">.</span><span class="n">insert_symbol</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">is_private</span><span class="p">:</span>
                    <span class="n">scope</span><span class="o">.</span><span class="n">insert_symbol</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_language</span> <span class="o">==</span> <span class="s1">&#39;fortran&#39;</span><span class="p">:</span>
            <span class="n">vars_to_wrap_decs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Declare</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="n">module_variable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
                                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">variables</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">is_private</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vars_to_wrap_decs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Declare</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">module_variable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> \
                                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">variables</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">is_private</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_module_name</span>  <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">name</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">SeparatorComment</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_language</span> <span class="o">==</span> <span class="s1">&#39;fortran&#39;</span><span class="p">:</span>
            <span class="n">static_funcs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_static_function</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">funcs</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">static_funcs</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">funcs</span>
        <span class="n">function_signatures</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">static_function_signature</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">static_funcs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_language</span> <span class="o">==</span> <span class="s1">&#39;fortran&#39;</span><span class="p">:</span>
            <span class="n">var_wrappers</span> <span class="o">=</span> <span class="p">[</span><span class="n">wrap_module_array_var</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span> <span class="n">expr</span><span class="p">)</span> \
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">variables</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">is_private</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">function_signatures</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_signature</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">var_wrappers</span><span class="p">)</span>

        <span class="n">interface_funcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">interfaces</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">functions</span><span class="p">]</span>
        <span class="n">funcs</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">expr</span><span class="o">.</span><span class="n">interfaces</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">funcs_to_wrap</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interface_funcs</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_in_header</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">decs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;extern &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">vars_to_wrap_decs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_in_header</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">function_defs</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">)</span>
        <span class="n">cast_functions</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CCodePrinter</span><span class="o">.</span><span class="n">_print_FunctionDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                                       <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast_functions_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">method_def_func</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;{{</span><span class="se">\n</span><span class="s1">&#39;</span>
                                     <span class="s1">&#39;&quot;</span><span class="si">{name}</span><span class="s1">&quot;,</span><span class="se">\n</span><span class="s1">&#39;</span>
                                     <span class="s1">&#39;(PyCFunction)</span><span class="si">{wrapper_name}</span><span class="s1">,</span><span class="se">\n</span><span class="s1">&#39;</span>
                                     <span class="s1">&#39;METH_VARARGS | METH_KEYWORDS,</span><span class="se">\n</span><span class="s1">&#39;</span>
                                     <span class="s1">&#39;</span><span class="si">{doc_string}</span><span class="se">\n</span><span class="s1">&#39;</span>
                                     <span class="s1">&#39;}},</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                            <span class="n">name</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_python_name</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                                            <span class="n">wrapper_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function_wrapper_names</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">],</span>
                                            <span class="n">doc_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">LiteralString</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">doc_string</span><span class="o">.</span><span class="n">comments</span><span class="p">)))</span> \
                                                        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">doc_string</span> <span class="k">else</span> <span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">)</span>
                                     <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">funcs</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">expr</span><span class="o">.</span><span class="n">init_func</span><span class="p">)</span>

        <span class="n">slots_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_slots&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">exec_func_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="s1">&#39;exec_func&#39;</span><span class="p">)</span>
        <span class="n">slots_def</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;static PyModuleDef_Slot </span><span class="si">{name}</span><span class="s1">[] = {{</span><span class="se">\n</span><span class="s1">&#39;</span>
                     <span class="s1">&#39;{{Py_mod_exec, </span><span class="si">{exec_func}</span><span class="s1">}},</span><span class="se">\n</span><span class="s1">&#39;</span>
                     <span class="s1">&#39;{{0, NULL}},</span><span class="se">\n</span><span class="s1">&#39;</span>
                     <span class="s1">&#39;}};</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">slots_name</span><span class="p">,</span>
                             <span class="n">exec_func</span> <span class="o">=</span> <span class="n">exec_func_name</span><span class="p">)</span>

        <span class="n">method_def_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_methods&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">method_def</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;static PyMethodDef </span><span class="si">{method_def_name}</span><span class="s1">[] = {{</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;</span><span class="si">{method_def_func}</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;{{ NULL, NULL, 0, NULL}}</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s1">&#39;}};</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method_def_name</span> <span class="o">=</span> <span class="n">method_def_name</span><span class="p">,</span>
                            <span class="n">method_def_func</span> <span class="o">=</span> <span class="n">method_def_func</span><span class="p">))</span>

        <span class="n">module_def_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_module&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">module_def</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;static struct PyModuleDef </span><span class="si">{module_def_name}</span><span class="s1"> = {{</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;PyModuleDef_HEAD_INIT,</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;/* name of module */</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="se">\&quot;</span><span class="si">{mod_name}</span><span class="se">\&quot;</span><span class="s1">,</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;/* module documentation, may be NULL */</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;NULL,</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="c1">#TODO: Add documentation</span>
                <span class="s1">&#39;/* size of per-interpreter state of the module, or -1 if the module keeps state in global variables. */</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;0,</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{method_def_name}</span><span class="s1">,</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{slots_name}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;}};</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">module_def_name</span> <span class="o">=</span> <span class="n">module_def_name</span><span class="p">,</span>
                    <span class="n">mod_name</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">method_def_name</span> <span class="o">=</span> <span class="n">method_def_name</span><span class="p">,</span>
                    <span class="n">slots_name</span> <span class="o">=</span> <span class="n">slots_name</span><span class="p">))</span>

        <span class="n">exec_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_module_exec_function</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">exec_func_name</span><span class="p">)</span>

        <span class="n">init_func</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;PyMODINIT_FUNC PyInit_</span><span class="si">{mod_name}</span><span class="s1">(void)</span><span class="se">\n</span><span class="s1">{{</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;import_array();</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;return PyModuleDef_Init(&amp;</span><span class="si">{module_def_name}</span><span class="s1">);</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;}}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mod_name</span><span class="o">=</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">module_def_name</span> <span class="o">=</span> <span class="n">module_def_name</span><span class="p">))</span>

        <span class="c1"># Print imports last to be sure that all additional_imports have been collected</span>
        <span class="n">imports</span>  <span class="o">=</span> <span class="n">module_imports</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">imports</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_additional_imports</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="n">imports</span>  <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">imports</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">exit_scope</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;#define PY_ARRAY_UNIQUE_SYMBOL CWRAPPER_ARRAY_API</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{imports}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{variable_declarations}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{function_signatures}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{sep}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{cast_functions}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{sep}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{function_defs}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{exec_func}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{sep}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{method_def}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{sep}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{slots_def}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{sep}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{module_def}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{sep}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;</span><span class="si">{init_func}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">imports</span> <span class="o">=</span> <span class="n">imports</span><span class="p">,</span>
                    <span class="n">variable_declarations</span> <span class="o">=</span> <span class="n">decs</span><span class="p">,</span>
                    <span class="n">function_signatures</span> <span class="o">=</span> <span class="n">function_signatures</span><span class="p">,</span>
                    <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">,</span>
                    <span class="n">cast_functions</span> <span class="o">=</span> <span class="n">cast_functions</span><span class="p">,</span>
                    <span class="n">function_defs</span> <span class="o">=</span> <span class="n">function_defs</span><span class="p">,</span>
                    <span class="n">exec_func</span> <span class="o">=</span> <span class="n">exec_func</span><span class="p">,</span>
                    <span class="n">method_def</span> <span class="o">=</span> <span class="n">method_def</span><span class="p">,</span>
                    <span class="n">slots_def</span>  <span class="o">=</span> <span class="n">slots_def</span><span class="p">,</span>
                    <span class="n">module_def</span> <span class="o">=</span> <span class="n">module_def</span><span class="p">,</span>
                    <span class="n">init_func</span> <span class="o">=</span> <span class="n">init_func</span><span class="p">))</span></div></div>

<div class="viewcode-block" id="cwrappercode"><a class="viewcode-back" href="../../../../pyccel.codegen.printing.html#pyccel.codegen.printing.cwrappercode.cwrappercode">[docs]</a><span class="k">def</span> <span class="nf">cwrappercode</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">target_language</span><span class="p">,</span> <span class="n">assign_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts an expr to a string of c wrapper code</span>

<span class="sd">    expr : Expr</span>
<span class="sd">        A pyccel expression to be converted.</span>
<span class="sd">    filename : str</span>
<span class="sd">        The name of the file being translated. Used in error printing</span>
<span class="sd">    assign_to : optional</span>
<span class="sd">        When given, the argument is used as the name of the variable to which</span>
<span class="sd">        the expression is assigned. Can be a string, ``Symbol``,</span>
<span class="sd">        ``MatrixSymbol``, or ``Indexed`` type. This is helpful in case of</span>
<span class="sd">        line-wrapping, or for expressions that generate multi-line statements.</span>
<span class="sd">    precision : integer, optional</span>
<span class="sd">        The precision for numbers such as pi [default=15].</span>
<span class="sd">    user_functions : dict, optional</span>
<span class="sd">        A dictionary where keys are ``FunctionClass`` instances and values are</span>
<span class="sd">        their string representations. Alternatively, the dictionary value can</span>
<span class="sd">        be a list of tuples i.e. [(argument_test, cfunction_string)]. See below</span>
<span class="sd">        for examples.</span>
<span class="sd">    dereference : iterable, optional</span>
<span class="sd">        An iterable of symbols that should be dereferenced in the printed code</span>
<span class="sd">        expression. These would be values passed by address to the function.</span>
<span class="sd">        For example, if ``dereference=[a]``, the resulting code would print</span>
<span class="sd">        ``(*a)`` instead of ``a``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">CWrapperCodePrinter</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">target_language</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span><span class="o">.</span><span class="n">doprint</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">assign_to</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2023, *.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>