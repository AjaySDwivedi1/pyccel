

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pyccel.parser.scope &mdash; pyccel * documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/fonts.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> pyccel
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">docBranck</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyccel</a>
        
      </nav>


      <div class="wy-nav-content">
<div class="git-ribbon">
  <a href="http://github.com/SwissDataScienceCenter" rel="me">Join us on GitHub</a>
</div>

        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pyccel.parser.scope</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyccel.parser.scope</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#------------------------------------------------------------------------------------------#</span>
<span class="c1"># This file is part of Pyccel which is released under MIT License. See the LICENSE file or #</span>
<span class="c1"># go to https://github.com/pyccel/pyccel/blob/master/LICENSE for full license details.     #</span>
<span class="c1">#------------------------------------------------------------------------------------------#</span>
<span class="sd">&quot;&quot;&quot; Module containing the Scope class</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pyccel.ast.core</span>      <span class="kn">import</span> <span class="n">ClassDef</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.datatypes</span> <span class="kn">import</span> <span class="n">DataTypeFactory</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.headers</span>   <span class="kn">import</span> <span class="n">MacroFunction</span><span class="p">,</span> <span class="n">MacroVariable</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.headers</span>   <span class="kn">import</span> <span class="n">FunctionHeader</span><span class="p">,</span> <span class="n">ClassHeader</span><span class="p">,</span> <span class="n">MethodHeader</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.internals</span> <span class="kn">import</span> <span class="n">PyccelSymbol</span>
<span class="kn">from</span> <span class="nn">pyccel.ast.variable</span>  <span class="kn">import</span> <span class="n">Variable</span><span class="p">,</span> <span class="n">DottedName</span>

<span class="kn">from</span> <span class="nn">pyccel.errors.errors</span> <span class="kn">import</span> <span class="n">Errors</span>

<span class="kn">from</span> <span class="nn">pyccel.naming.pythonnameclashchecker</span> <span class="kn">import</span> <span class="n">PythonNameClashChecker</span>

<span class="kn">from</span> <span class="nn">pyccel.utilities.strings</span> <span class="kn">import</span> <span class="n">create_incremented_string</span>

<span class="n">errors</span> <span class="o">=</span> <span class="n">Errors</span><span class="p">()</span>

<div class="viewcode-block" id="Scope"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope">[docs]</a><span class="k">class</span> <span class="nc">Scope</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Class representing all objects defined within a given</span>
<span class="sd">    scope</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    decorators : dict</span>
<span class="sd">                 A dictionary of any decorators which operate on</span>
<span class="sd">                 objects in this scope</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">allow_loop_scoping</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">name_clash_checker</span> <span class="o">=</span> <span class="n">PythonNameClashChecker</span><span class="p">()</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_imports&#39;</span><span class="p">,</span><span class="s1">&#39;_locals&#39;</span><span class="p">,</span><span class="s1">&#39;_parent_scope&#39;</span><span class="p">,</span><span class="s1">&#39;_sons_scopes&#39;</span><span class="p">,</span>
            <span class="s1">&#39;_is_loop&#39;</span><span class="p">,</span><span class="s1">&#39;_loops&#39;</span><span class="p">,</span><span class="s1">&#39;_temporary_variables&#39;</span><span class="p">,</span> <span class="s1">&#39;_used_symbols&#39;</span><span class="p">,</span>
            <span class="s1">&#39;_dummy_counter&#39;</span><span class="p">,</span><span class="s1">&#39;_original_symbol&#39;</span><span class="p">)</span>

    <span class="n">categories</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;functions&#39;</span><span class="p">,</span><span class="s1">&#39;variables&#39;</span><span class="p">,</span><span class="s1">&#39;classes&#39;</span><span class="p">,</span>
            <span class="s1">&#39;imports&#39;</span><span class="p">,</span><span class="s1">&#39;symbolic_functions&#39;</span><span class="p">,</span>
            <span class="s1">&#39;macros&#39;</span><span class="p">,</span><span class="s1">&#39;templates&#39;</span><span class="p">,</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span><span class="s1">&#39;decorators&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cls_constructs&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">decorators</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_loop</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">parent_scope</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">used_symbols</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">original_symbols</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_imports</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:{}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span>  <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:{}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">categories</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_temporary_variables</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">used_symbols</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">used_symbols</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Used symbols must be a dictionary&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_used_symbols</span> <span class="o">=</span> <span class="n">used_symbols</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_symbol</span> <span class="o">=</span> <span class="n">original_symbols</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">decorators</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;decorators&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">decorators</span><span class="p">)</span>

        <span class="c1"># TODO use another name for headers</span>
        <span class="c1">#      =&gt; reserved keyword, or use __</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_scope</span>       <span class="o">=</span> <span class="n">parent_scope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sons_scopes</span>        <span class="o">=</span> <span class="p">{}</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">_is_loop</span> <span class="o">=</span> <span class="n">is_loop</span>
        <span class="c1"># scoping for loops</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loops</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Retrieve __dict__ ignoring None</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Missing attribute from slots. Please update pickle file&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>

<div class="viewcode-block" id="Scope.new_child_scope"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.new_child_scope">[docs]</a>    <span class="k">def</span> <span class="nf">new_child_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new child Scope object which has the current object as parent.</span>

<span class="sd">        The parent scope can access the child scope through the &#39;_sons_scopes&#39;</span>
<span class="sd">        dictionary, using the provided name as key. Conversely, the child scope</span>
<span class="sd">        can access the parent scope through the &#39;parent_scope&#39; attribute.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the new scope, used as a key to retrieve the new scope.</span>

<span class="sd">        kwargs : dict</span>
<span class="sd">            Keyword arguments passed to __init__() for object initialization.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        child : Scope</span>
<span class="sd">            New child scope, which has the current object as parent.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;parent_scope&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A child of </span><span class="si">{}</span><span class="s2"> cannot have a parent </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ps</span><span class="p">))</span>

        <span class="n">child</span> <span class="o">=</span> <span class="n">Scope</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">parent_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_son</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">child</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">imports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A dictionary of objects imported in this scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imports</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A dictionary of variables defined in this scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A dictionary of classes defined in this scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A dictionary of functions defined in this scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;functions&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">macros</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A dictionary of macros defined in this scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;macros&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A dictionary of user defined headers which may</span>
<span class="sd">        be applied to functions in this scope&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">templates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A dictionary of user defined templates which may</span>
<span class="sd">        be applied to functions in this scope&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;templates&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">decorators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dictionary of Pyccel decorators which may be</span>
<span class="sd">        applied to a function definition in this scope.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;decorators&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cls_constructs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A dictionary of datatypes for the classes defined in</span>
<span class="sd">        this scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;cls_constructs&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sons_scopes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A dictionary of all the scopes contained within the</span>
<span class="sd">        current scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sons_scopes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">symbolic_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A dictionary of symbolic functions defined in this scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;symbolic_functions&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="Scope.find"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">category</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Find and return the specified object in the scope.</span>
<span class="sd">        If the object cannot be found then None is returned</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the object we are searching for</span>
<span class="sd">        category : str</span>
<span class="sd">            The type of object we are searching for.</span>
<span class="sd">            This must be one of the strings in Scope.categories</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="p">([</span><span class="n">category</span><span class="p">]</span> <span class="k">if</span> <span class="n">category</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="n">l</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">imports</span><span class="p">[</span><span class="n">l</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">imports</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># Walk up the tree of Scope objects, until the root if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Scope.find_all"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.find_all">[docs]</a>    <span class="k">def</span> <span class="nf">find_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Find and return all objects from the specified category</span>
<span class="sd">        in the scope.</span>

<span class="sd">        Parameter</span>
<span class="sd">        ---------</span>
<span class="sd">        category : str</span>
<span class="sd">            The type of object we are searching for.</span>
<span class="sd">            This must be one of the strings in Scope.categories</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="n">category</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">result</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Indicates whether this scope describes a loop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_loop</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">loops</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the scopes associated with any loops within this scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loops</span>

<div class="viewcode-block" id="Scope.create_new_loop_scope"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.create_new_loop_scope">[docs]</a>    <span class="k">def</span> <span class="nf">create_new_loop_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a new Scope within the current scope describing</span>
<span class="sd">        a loop (For/While/etc)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_scope</span> <span class="o">=</span> <span class="n">Scope</span><span class="p">(</span><span class="n">decorators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decorators</span><span class="p">,</span> <span class="n">is_loop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="n">parent_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_loop</span><span class="p">(</span><span class="n">new_scope</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_scope</span></div>

<div class="viewcode-block" id="Scope.insert_variable"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.insert_variable">[docs]</a>    <span class="k">def</span> <span class="nf">insert_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a variable to the current scope</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var  : Variable</span>
<span class="sd">                The variable to be inserted into the current scope</span>
<span class="sd">        name : str</span>
<span class="sd">                The name of the variable in the python code</span>
<span class="sd">                Default : var.name</span>
<span class="sd">        python_scope : bool</span>
<span class="sd">                If true then we assume that python scoping applies.</span>
<span class="sd">                In this case variables declared in loops exist beyond</span>
<span class="sd">                the end of the loop. Otherwise variables may be local</span>
<span class="sd">                to loops</span>
<span class="sd">                Default : True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A temporary variable should have a name generated by Scope.get_new_name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">Variable</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;variable must be of type Variable&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_loop_scoping</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_loop</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;New variable </span><span class="si">{}</span><span class="s1"> already exists in scope&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_temporary_variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_used_symbols</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert_symbol</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Scope.remove_variable"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.remove_variable">[docs]</a>    <span class="k">def</span> <span class="nf">remove_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Remove a variable from anywhere in scope</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        var  : Variable</span>
<span class="sd">                The variable to be removed</span>
<span class="sd">        name : str</span>
<span class="sd">                The name of the variable in the python code</span>
<span class="sd">                Default : var.name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_used_symbols</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="o">.</span><span class="n">remove_variable</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Variable not found in scope&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Scope.insert_class"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.insert_class">[docs]</a>    <span class="k">def</span> <span class="nf">insert_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a class to the current scope</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cls  : ClassDef</span>
<span class="sd">                The class to be inserted into the current scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ClassDef</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;class must be of type ClassDef&#39;</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_loop</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="o">.</span><span class="n">insert_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#if name in self._locals[&#39;classes&#39;]:</span>
            <span class="c1">#    raise RuntimeError(&#39;New class already exists in scope&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span></div>

<div class="viewcode-block" id="Scope.insert_macro"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.insert_macro">[docs]</a>    <span class="k">def</span> <span class="nf">insert_macro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macro</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a macro to the current scope</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">macro</span><span class="p">,</span> <span class="p">(</span><span class="n">MacroFunction</span><span class="p">,</span> <span class="n">MacroVariable</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Expected a macro&#39;</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">macro</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">macro</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">DottedName</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;macros&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">macro</span></div>

<div class="viewcode-block" id="Scope.insert_template"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.insert_template">[docs]</a>    <span class="k">def</span> <span class="nf">insert_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;append the scope&#39;s templates with the given template&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_locals</span><span class="p">[</span><span class="s1">&#39;templates&#39;</span><span class="p">][</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr</span></div>

<div class="viewcode-block" id="Scope.insert_header"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.insert_header">[docs]</a>    <span class="k">def</span> <span class="nf">insert_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a header to the current scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="p">(</span><span class="n">FunctionHeader</span><span class="p">,</span> <span class="n">MethodHeader</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">expr</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">ClassHeader</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr</span>

            <span class="c1">#  create a new Datatype for the current class</span>

            <span class="n">iterable</span> <span class="o">=</span> <span class="s1">&#39;iterable&#39;</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">options</span>
            <span class="n">with_construct</span> <span class="o">=</span> <span class="s1">&#39;with&#39;</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">options</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">DataTypeFactory</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;_name&#39;</span><span class="p">,</span>
                                    <span class="n">is_iterable</span><span class="o">=</span><span class="n">iterable</span><span class="p">,</span>
                                    <span class="n">is_with_construct</span><span class="o">=</span><span class="n">with_construct</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cls_constructs</span><span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;header of type</span><span class="si">{0}</span><span class="s1"> is not supported&#39;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">expr</span><span class="p">)))</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Scope.insert_symbol"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.insert_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">insert_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a new symbol to the scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_loop_scoping</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_loop</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="o">.</span><span class="n">insert_symbol</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_used_symbols</span><span class="p">:</span>
            <span class="n">collisionless_symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_clash_checker</span><span class="o">.</span><span class="n">get_collisionless_name</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_used_symbols</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">collisionless_symbol</span> <span class="o">=</span> <span class="n">PyccelSymbol</span><span class="p">(</span><span class="n">collisionless_symbol</span><span class="p">,</span>
                    <span class="n">is_temp</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="s1">&#39;is_temp&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_used_symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span> <span class="o">=</span> <span class="n">collisionless_symbol</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_original_symbol</span><span class="p">[</span><span class="n">collisionless_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbol</span></div>


<div class="viewcode-block" id="Scope.insert_symbols"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.insert_symbols">[docs]</a>    <span class="k">def</span> <span class="nf">insert_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add multiple new symbols to the scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert_symbol</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_used_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get all symbols which already exist in this scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="p">:</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="o">.</span><span class="n">all_used_symbols</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">symbols</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_used_symbols</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">symbols</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">local_used_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get all symbols which already exist in this scope</span>
<span class="sd">        excluding enclosing scopes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_used_symbols</span>

<div class="viewcode-block" id="Scope.get_new_incremented_symbol"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.get_new_incremented_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">get_new_incremented_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">counter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new name by adding a numbered suffix to the provided prefix.</span>

<span class="sd">          Parameters</span>
<span class="sd">          ----------</span>
<span class="sd">          prefix : str</span>

<span class="sd">          Returns</span>
<span class="sd">          -------</span>
<span class="sd">          new_name     : str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">new_name</span><span class="p">,</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">create_incremented_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_used_symbols</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span><span class="p">)</span>

        <span class="n">new_symbol</span> <span class="o">=</span> <span class="n">PyccelSymbol</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">is_temp</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">insert_symbol</span><span class="p">(</span><span class="n">new_symbol</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_symbol</span><span class="p">,</span> <span class="n">counter</span></div>

<div class="viewcode-block" id="Scope.get_new_name"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.get_new_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_new_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new name. A current_name can be provided indicating the name the</span>
<span class="sd">        user would like to use if possible. If this name is not available then it</span>
<span class="sd">        will be used as a prefix for the new name.</span>
<span class="sd">        If no current_name is provided, then the standard prefix is used, and the</span>
<span class="sd">        dummy counter is used and updated to facilitate finding the next value of</span>
<span class="sd">        this common case</span>

<span class="sd">          Parameters</span>
<span class="sd">          ----------</span>
<span class="sd">          current_name : str</span>

<span class="sd">          Returns</span>
<span class="sd">          -------</span>
<span class="sd">          new_name     : PyccelSymbol</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">current_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_clash_checker</span><span class="o">.</span><span class="n">has_clash</span><span class="p">(</span><span class="n">current_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_used_symbols</span><span class="p">):</span>
            <span class="n">new_name</span> <span class="o">=</span> <span class="n">PyccelSymbol</span><span class="p">(</span><span class="n">current_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert_symbol</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new_name</span>

        <span class="k">if</span> <span class="n">current_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Avoid confusing names by also searching in parent scopes</span>
            <span class="n">new_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_counter</span> <span class="o">=</span> <span class="n">create_incremented_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_used_symbols</span><span class="p">,</span>
                                                <span class="n">prefix</span> <span class="o">=</span> <span class="n">current_name</span><span class="p">,</span>
                                                <span class="n">counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_counter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># When a name is suggested, try to stick to it</span>
            <span class="n">new_name</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">create_incremented_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_used_symbols</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="n">current_name</span><span class="p">)</span>

        <span class="n">new_name</span> <span class="o">=</span> <span class="n">PyccelSymbol</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">is_temp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">insert_symbol</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_name</span></div>

<div class="viewcode-block" id="Scope.get_temporary_variable"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.get_temporary_variable">[docs]</a>    <span class="k">def</span> <span class="nf">get_temporary_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype_or_var</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a temporary variable</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dtype_or_var : str, DataType, Variable</span>
<span class="sd">            In the case of a string of DataType: The type of the Variable to be created</span>
<span class="sd">            In the case of a Variable: a Variable which will be cloned to set all the Variable properties</span>
<span class="sd">        name : str</span>
<span class="sd">            The requested name for the new variable</span>
<span class="sd">        kwargs : dict</span>
<span class="sd">            See Variable keyword arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtype_or_var</span><span class="p">,</span> <span class="n">Variable</span><span class="p">):</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">dtype_or_var</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">is_temp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">dtype_or_var</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">is_temp</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_variable</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">var</span></div>

<div class="viewcode-block" id="Scope.get_expected_name"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.get_expected_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_expected_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get a name with no collisions, ideally the provided name.</span>
<span class="sd">        The provided name should already exist in the symbols</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">start_name</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_new_name</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">start_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_used_symbols</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_used_symbols</span><span class="p">[</span><span class="n">start_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="o">.</span><span class="n">get_expected_name</span><span class="p">(</span><span class="n">start_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> does not exist in scope&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="Scope.create_product_loop_scope"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.create_product_loop_scope">[docs]</a>    <span class="k">def</span> <span class="nf">create_product_loop_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inner_scope</span><span class="p">,</span> <span class="n">n_loops</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a n_loops loop scopes such that the innermost loop</span>
<span class="sd">        has the scope inner_scope</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        inner_scope : Namespace</span>
<span class="sd">                      Namespace describing the innermost scope</span>
<span class="sd">        n_loops     : The number of loop scopes required</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">inner_scope</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loops</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">scopes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">create_new_loop_scope</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_loops</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">scopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scopes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">create_new_loop_scope</span><span class="p">())</span>
        <span class="n">inner_scope</span><span class="o">.</span><span class="n">update_parent_scope</span><span class="p">(</span><span class="n">scopes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">is_loop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">scopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inner_scope</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scopes</span></div>

<div class="viewcode-block" id="Scope.collect_all_imports"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.collect_all_imports">[docs]</a>    <span class="k">def</span> <span class="nf">collect_all_imports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Collect the names of all modules necessary to understand this scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">imports</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_imports</span><span class="p">[</span><span class="s1">&#39;imports&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">imports</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sons_scopes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">collect_all_imports</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">imports</span></div>

<div class="viewcode-block" id="Scope.update_parent_scope"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.update_parent_scope">[docs]</a>    <span class="k">def</span> <span class="nf">update_parent_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_parent</span><span class="p">,</span> <span class="n">is_loop</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Change the parent scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">is_loop</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="o">.</span><span class="n">remove_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent_scope</span> <span class="o">=</span> <span class="n">new_parent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="o">.</span><span class="n">add_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="o">.</span><span class="n">remove_son</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent_scope</span> <span class="o">=</span> <span class="n">new_parent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="o">.</span><span class="n">add_son</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parent_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the enclosing scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_scope</span>

<div class="viewcode-block" id="Scope.remove_loop"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.remove_loop">[docs]</a>    <span class="k">def</span> <span class="nf">remove_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Remove a loop from the scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loops</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span></div>

<div class="viewcode-block" id="Scope.remove_son"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.remove_son">[docs]</a>    <span class="k">def</span> <span class="nf">remove_son</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">son</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Remove a sub-scope from the scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sons_scopes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="n">son</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sons_scopes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="Scope.add_loop"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.add_loop">[docs]</a>    <span class="k">def</span> <span class="nf">add_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Make parent aware of new child loop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">loop</span><span class="o">.</span><span class="n">parent_scope</span> <span class="ow">is</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span></div>

<div class="viewcode-block" id="Scope.add_son"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.add_son">[docs]</a>    <span class="k">def</span> <span class="nf">add_son</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">son</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Make parent aware of new child</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">son</span><span class="o">.</span><span class="n">parent_scope</span> <span class="ow">is</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sons_scopes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">son</span></div>

<div class="viewcode-block" id="Scope.get_python_name"><a class="viewcode-back" href="../../../pyccel.parser.html#pyccel.parser.scope.Scope.get_python_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_python_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the name used in the original python code from the</span>
<span class="sd">        name used by the variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_symbol</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_symbol</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_scope</span><span class="o">.</span><span class="n">get_python_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find </span><span class="si">{}</span><span class="s2"> in scope&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">python_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get map of new names to original python names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_symbol</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2023, *.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>